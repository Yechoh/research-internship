20170209-112610["Bin",2,["TaskId",10,1259],[],["Tip"],["Bin",1,["TaskId",10,1271],[{"taskId":["TaskId",10,1272],"index":0,"detached":false,"attributes":["Tip"],"value":["Value","module webIDE\r\n\r\nimport iTasks\r\n\r\nimport iTasks.API.Extensions.Admin.WorkflowAdmin\r\nimport iTasks.UI.Layout, iTasks.UI.Definition, iTasks.UI.Editor.Builtin\r\nimport iTasks.API.Extensions.Editors.Ace\r\nimport StdFile, System.File\r\nimport System.Directory\r\nimport System.FilePath\r\nimport Data.Error\r\n\r\nimport createAndRunExec\r\nimport directoryBrowsing\r\n\r\n\/\/ -------------\r\n\r\nimport qualified Data.Map as DM\r\n:: Settings = \t{ dirCpm \t:: FilePath\r\n\t\t\t\t, dirClean\t:: FilePath\r\n\t\t\t\t}\r\nderive class iTask Settings\r\n\r\nsettings = sharedStore \"settings\" \t{ dirCpm = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\/cpm.exe\"\r\n\t\t\t\t\t\t\t\t\t, dirClean = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\"\r\n\t\t\t\t\t\t\t\t\t}\r\nupdSettings \r\n\t= \t\tupdateSharedInformation \"Current Setting: \" [] settings\r\n\r\n\/\/ utility functions\r\n\r\nisCleanFile file = isMember (takeExtension file) [\"icl\", \"dcl\", \"prj\", \"abc\", \"sapl\"]\r\n\r\nselectIcon pwd _ \t = Nothing\t\/\/ don't know where to store icons yet\r\nselectIcon pwd \"icl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.icl.ico\")\r\nselectIcon pwd \"dcl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.dcl.ico\")\r\nselectIcon pwd \"prj\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.prj.ico\")\r\nselectIcon pwd \"abc\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.abc.ico\")\r\nselectIcon pwd _ \t = Nothing\r\n\r\n\/\/ missing operator hack for avoiding continues \r\n\r\n(>>|-) infixl 1 :: (Task a) (Task b) -> Task b | iTask a & iTask b\r\n(>>|-) ma mb = ma >>- \\_ -> mb\r\n\r\n\/\/ -------------\r\n\r\nStart :: *World -> *World\r\nStart world = startEngine (manageWorklist ide) world\r\n\/\/Start world = startEngine ideDashboard world\r\n\r\n\/\/ ------------- to do:\r\n\r\nideDashboard :: Task ()\r\nideDashboard\r\n\t=  \tforever treePanel <<@ ApplyLayout layout\r\nwhere\r\n\ttreePanel = treeEdit2\r\n\r\n\tlayout = sequenceLayouts\r\n\t\t[ arrangeWithSideBar 0 LeftSide 260 True\r\n\t\t]\r\n\r\ntreeEdit2 :: Task ()\r\ntreeEdit2 \r\n\t=\t\t\t\tgetPwdName\r\n \t>>= \\pwd ->\t\tselectFromTree pwd isCleanFile\r\n\/\/\t>>= \\path ->\tviewInformation \"selected fule\" [] path\r\n\t>^*\t\t\t\t[ \tOnAction  (Action \"Open\") (hasValue edit2)\r\n\t \t\t\t\t]\r\n\t>>|\t\t\t\treturn ()\r\nwhere\r\n edit2 path\r\n\t=\t\t\t\treadFromFile path\r\n\t>>= \\content ->\tappendTopLevelTask ('DM'.fromList [(\"title\",\"malcom x\")]) True (editFile path (dropDirectory path) content)\r\n\t\t\t\t\t\t <<@ ToWindow FloatingWindow AlignMiddle AlignCenter\r\n\t>>|-\t\t\treturn ()\r\n\r\n\/\/ ------------- ide try outs\r\n\r\nide :: [Workflow]\r\nide =\r\n\t[ workflow \"Brose & Edit\"\t\t\"Browse and Edit a file\" \t\tbrowseEdit\r\n\t, workflow \"Tree browse & Edit\"\t\"Browse and Edit a file\" \t\ttreeEdit\r\n\t, workflow \"Settings\"\t\t\t\"View and change settings\"  \tupdSettings\r\n\r\n\t, workflow \"Browse\"\t\t\t\t\"Browse through file system\" \t(browseDirectory isCleanFile <<@ ApplyLayout (toWindow FloatingWindow AlignTop AlignLeft))\r\n\t]\r\n\r\ntreeEdit :: Task ()\r\ntreeEdit \r\n\t=\t\t\t\t\t\t\tgetPwdName\r\n \t>>= \\pwd ->\t\t\t\t\tselectFromTree pwd isCleanFile \r\n\t>>= \\path ->\t\t\t\tviewInformation \"selected fule\" [] path\r\n\t>>= \\path ->\t\t\t\treadFromFile path\r\n\t>>- \\content -> \t\t\teditFile (takeDirectory path) (dropDirectory path) content\r\n\r\nbrowseEdit :: Task ()\r\nbrowseEdit \r\n\t=\t\t\t\t\t\t\tbrowseDirectory isCleanFile\r\n\t>>- \\((path,_),mbName) -> \t\r\n\tif (isNothing mbName)\t\t(return ())\r\n\t(\t\t\t\t\t\t\treadFromFile (path <\/> fromJust mbName)\r\n\t>>- \\content -> \t\t\teditFile path (fromJust mbName) content\r\n\t)\r\n\r\n\/\/ very simple editor\r\n\r\neditFile :: String String String -> Task ()\r\neditFile path name content \r\n= withShared content \r\n    (\\sc ->\r\n\t \t\tupdateSharedInformation (path <\/> name) [UpdateUsing id (\\_ nsc -> nsc) aceTextArea] sc\t\t\t\t\/\/ seems to be a bug in the current UpdateUsing ... no change returned\r\n\r\n\t >^*\t[ \tOnAction  ActionSave    \t(hasValue (saveFile (path <\/> name)))\r\n\t \t\t,\tOnAction  ActionSaveAs\t\t(hasValue (saveFileAs (path <\/> name)))\r\n\t \t\t]\r\n\t \t\t++ \r\n\t \t\tif (takeExtension name <> \"icl\") []\r\n\t \t\t[\tOnAction (Action \"Build\")\t(hasValue (const (buildProject path (dropExtension name))))\r\n\t \t\t,\tOnAction (Action \"Run\")\t\t(always (runExec (path <\/> dropExtension name +++ \".exe\") 8080))\r\n\t \t\t]\r\n\t >>*\t[   OnAction  ActionQuit    \t(always (return ()))\r\n\t\t    ]\r\n\t)\r\nwhere\r\n\tsaveFile path content \r\n\t\t= writeToFile path content @! () \r\n\t\r\n\tsaveFileAs path content \r\n\t\t= \t\tupdateInformation \"Where to write to ?\" [] path\r\n\t\t>>*\t\t[\tOnAction ActionSave\t\t(hasValue (\\name -> saveFile name content))\r\n\t\t\t \t,\tOnAction ActionCancel\t(always (return ()))\r\n\t\t\t \t]\r\n\t\t\r\n\tbuildProject buildPath iclFileName \r\n\t\t= \t\t\t\t\tget settings \r\n\t\t>>- \\curSet ->\t\tviewInformation \"Calling cpm : \" [] (curSet.dirCpm, buildPath, iclFileName)\r\n\t\t>>|\t\t\t\t\tcreateExec curSet.dirCpm buildPath iclFileName\r\n\r\n\r\n\r\n\r\n\r\n",false],"createdAt":6,"lastEvent":6}],["Tip"],["Tip"]]]
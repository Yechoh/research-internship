20170323-120207["Bin",4,["TaskId",3,2776],[{"taskId":["TaskId",3,2777],"index":0,"detached":false,"attributes":["Tip"],"value":["NoValue"],"createdAt":8,"lastEvent":8}],["Bin",1,["TaskId",3,2756],[],["Tip"],["Tip"]],["Bin",2,["TaskId",3,2777],[{"taskId":["TaskId",3,2778],"index":0,"detached":false,"attributes":["Tip"],"value":["Value",["Left",["module EditedwebIDE\r\r\r\n\r\r\r\nimport iTasks\r\r\r\n\r\r\r\nimport Text\r\r\r\nimport iTasks.API.Extensions.Admin.WorkflowAdmin\r\r\r\nimport iTasks.UI.Layout, iTasks.UI.Definition, iTasks.UI.Editor.Builtin\r\r\r\nimport iTasks.API.Extensions.Editors.Ace\r\r\r\nimport StdFile, System.File\r\r\r\nimport System.Directory\r\r\r\nimport System.FilePath\r\r\r\nimport _SystemArray\r\r\r\nimport Data.Error\r\r\r\nimport qualified Data.Map as DM\r\r\r\n\r\r\r\nimport createAndRunExec\r\r\r\nimport directoryBrowsing\r\r\r\n\r\r\r\nimport CpmLogic2\r\r\r\n\r\r\r\n\/\/ -------------\r\r\r\nimport qualified Data.Map as DM\r\r\r\n:: Settings = \t{ dirCpm \t:: FilePath\r\r\r\n\t\t\t\t, dirClean\t:: FilePath\r\r\r\n\t\t\t\t}\r\r\r\nderive class iTask Settings\r\r\r\n\r\r\r\nsettings = sharedStore \"settings\" \t{ dirCpm = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\/cpm.exe\"\r\r\r\n\t\t\t\t\t\t\t\t\t, dirClean = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\"\r\r\r\n\t\t\t\t\t\t\t\t\t}\r\r\r\nupdSettings \r\r\r\n\t= \t\tupdateSharedInformation \"Current Setting: \" [] settings\r\r\r\n\r\r\r\nerrorstate = sharedStore \"errors\" \"\"\r\r\r\n\r\r\r\n\/\/ utility functions\r\r\r\n\r\r\r\nisCleanFile file = isMember (takeExtension file) [\"icl\", \"dcl\", \"prj\", \"abc\", \"sapl\"]\r\r\r\n\r\r\r\nselectIcon pwd _ \t = Nothing\t\/\/ don't know where to store icons yet\r\r\r\n\/*selectIcon pwd \"icl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.icl.ico\")\r\r\r\nselectIcon pwd \"dcl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.dcl.ico\")\r\r\r\nselectIcon pwd \"prj\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.prj.ico\")\r\r\r\nselectIcon pwd \"abc\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.abc.ico\")\r\r\r\nselectIcon pwd _ \t = Nothing*\/\r\r\r\n\r\r\r\n\/\/ missing operator hack for avoiding continues \r\r\r\n\r\r\r\n(>>|-) infixl 1 :: (Task a) (Task b) -> Task b | iTask a & iTask b\r\r\r\n(>>|-) ma mb = ma >>- \\_ -> mb\r\r\r\n\r\r\r\n\/\/ -------------\r\r\r\n\r\r\r\nStart :: *World -> *World\r\r\r\nStart world = startEngine (treeEdit) world\r\r\r\n\/\/Start world = startEngine ideDashboard world\r\r\r\n\r\r\r\n\/\/ ------------- to do:\r\r\r\n\r\r\r\ntreeEdit :: Task ()\/\/(({#Char},String),())\r\r\r\ntreeEdit \r\r\r\n\t=\t\t\t\t\t\t\tgetPwdName\r\r\r\n \t>>= \\pwd ->\t\t\t\t\tselectFromTree pwd isCleanFile \r\r\r\n\t>>= \\path ->\t\t\t\tviewInformation \"selected file\" [] path\r\r\r\n\t>>= \\path ->\t\t\t\treadFromFile path\r\r\r\n\t>>- \\content -> \t\t\teditFile (takeDirectory path) (dropDirectory path) content\r\r\r\n\r\r\r\n\/*\r\r\r\n\/\/# (exists,world)  = fileExists mainmodule world\r\r\r\ncreateTempFiles :: String String -> Task (String,String)\r\r\r\ncreateTempFiles path name =\r\r\r\n\taccWorld (getCurrentDirectory) >>=\r\r\r\n\t\\cur. \r\r\r\n\t(createFile (cur <\\> \"Temp\" <\\> name) \"\" -&&-\r\r\r\n\t createFile (cur <\\> \"Temp\" <\\> replaceExtension name \"prj\")\r\r\r\n*\/\r\r\r\n\r\r\r\neditor :: String String (RWShared .() {#.Char} {#.Char})-> Task {#Char}\r\r\r\neditor path name sc =\r\r\r\n\tupdateSharedInformation (path <\/> name) [UpdateUsing id (\\_ nsc -> nsc) aceTextArea] sc\r\r\r\n\r\r\r\n\/\/updaters\r\r\r\n\/\/updateEverySecond :: \r\r\r\n\r\r\r\n\/\/end updaters\r\r\r\n\r\r\r\ncpmtask :: String (RWShared () {#Char} {#Char}) -> Task ()\r\r\r\ncpmtask iclloc content = \r\r\r\n\t\t\tget currentTime >>=\r\r\r\n\t\t\t\\now.  waitForTime2 {Time| now & sec=now.Time.sec+1} >>- \\_ ->\r\r\r\n\t\t\t(saveFile iclloc content) >>- \\_ ->\r\r\r\n\t\t\tappWorld (compile prjloc) \r\r\r\n\t\t\t>>- \\_ -> readFromFile errorloc\r\r\r\n\t\t\t>>- \\errors. \r\r\r\n\t\t\tset ((toString now) +++ errors) errorstate\r\r\r\n\t\t\t>>- \\_ -> cpmtask iclloc content\r\r\r\n\twhere\r\r\r\n\tsaveFile path content \r\r\r\n\t\t= get content >>= \\c. writeToFile path c @! ()\r\r\r\n\tprjloc = replaceExtension iclloc \"prj\"\r\r\r\n\terrorloc = replaceFileName iclloc \"errors\"\r\r\r\n\r\r\r\n\/\/(ifValue (\\(a,now1).get currentTime >>= \\now2. (now2.sec > now1.sec)))\r\r\r\n\r\r\r\nwaitForTime2 :: !Time -> Task Time\r\r\r\nwaitForTime2 time =\r\r\r\n\twatch currentTime >>* [OnValue (ifValue (\\now -> time < now) return)]\r\r\r\n\r\r\r\n\r\r\r\neditFile :: String String String -> Task () \/\/(({#Char},String),())\r\r\r\neditFile path name content =\r\r\r\n\taccWorld (getCurrentDirectory) >>=\r\r\r\n\t\\(Ok cur). appWorld (createProject (cur <\/> \"Temp\" <\/> name)) >>|\r\r\r\n\twithShared content\r\r\r\n\t(\\sc ->\r\r\r\n\t \t\t(editor path name sc \r\r\r\n\t \t\t-&&-\r\r\r\n\t \t\tviewSharedInformation \"errors\" [ViewUsing id (textArea 'DM'.newMap)] errorstate) \r\r\r\n\t \t\t-&&-\r\r\r\n\t \t\t(cpmtask (cur <\/> \"Temp\" <\/> name) sc)\r\r\r\n\t >^*\t[\tOnAction  ActionSave    \t(always (get sc >>= \\content. saveFile (path <\/> (\"Edited\" +++ name)) content))\r\r\r\n\t \t\t,\tOnAction  ActionSaveAs\t\t(always (get sc >>= \\content. saveFileAs (path <\/> name)content) )\r\r\r\n\t \t\t]\r\r\r\n\t \t\t++ \r\r\r\n\t \t\tif (takeExtension name <> \"icl\") []\r\r\r\n\t \t\t[\tOnAction (Action \"Build\")\t(always (get sc>>= \\content. (const (buildProject path (dropExtension name)) content)))\r\r\r\n\t \t\t,\tOnAction (Action \"Run\")\t\t(always (runExec (path <\/> dropExtension name +++ \".exe\") 8080))\r\r\r\n\t \t\t]\r\r\r\n\t >>*\t[   OnAction  ActionQuit    \t(always (return ()))\r\r\r\n\t\t    ]\r\r\r\n\t)\r\r\r\nwhere\r\r\r\n\tsaveFile path content \r\r\r\n\t\t= writeToFile path (remove_double_enters content) @! () \r\r\r\n\t\r\r\r\n\tsaveFileAs path content \r\r\r\n\t\t= \t\tupdateInformation \"Where to write to ?\" [] path\r\r\r\n\t\t>>*\t\t[\tOnAction ActionSave\t\t(hasValue (\\name -> saveFile name content))\r\r\r\n\t\t\t \t,\tOnAction ActionCancel\t(always (return ()))\r\r\r\n\t\t\t \t]\r\r\r\n\t\t\r\r\r\n\tbuildProject buildPath iclFileName \r\r\r\n\t\t= \t\t\t\t\tget settings \r\r\r\n\t\t>>- \\curSet ->\t\tviewInformation \"Calling cpm : \" [] (curSet.dirCpm, buildPath, iclFileName)\r\r\r\n\t\t>>|\t\t\t\t\tcreateExec curSet.dirCpm buildPath iclFileName\r\r\r\n\r\r\r\nremove_double_enters :: String -> String\r\r\r\nremove_double_enters str = {c \\\\ c <-: str | c <> '\\r'}\r\r\r\n\r\r\r\n\r\r\r\n",""]],false],"createdAt":8,"lastEvent":8},{"taskId":["TaskId",3,2779],"index":1,"detached":false,"attributes":["Tip"],"value":["NoValue"],"createdAt":8,"lastEvent":8}],["Tip"],["Bin",1,["TaskId",3,2778],[{"taskId":["TaskId",3,2780],"index":0,"detached":false,"attributes":["Tip"],"value":["Value",["Left","module EditedwebIDE\r\r\r\n\r\r\r\nimport iTasks\r\r\r\n\r\r\r\nimport Text\r\r\r\nimport iTasks.API.Extensions.Admin.WorkflowAdmin\r\r\r\nimport iTasks.UI.Layout, iTasks.UI.Definition, iTasks.UI.Editor.Builtin\r\r\r\nimport iTasks.API.Extensions.Editors.Ace\r\r\r\nimport StdFile, System.File\r\r\r\nimport System.Directory\r\r\r\nimport System.FilePath\r\r\r\nimport _SystemArray\r\r\r\nimport Data.Error\r\r\r\nimport qualified Data.Map as DM\r\r\r\n\r\r\r\nimport createAndRunExec\r\r\r\nimport directoryBrowsing\r\r\r\n\r\r\r\nimport CpmLogic2\r\r\r\n\r\r\r\n\/\/ -------------\r\r\r\nimport qualified Data.Map as DM\r\r\r\n:: Settings = \t{ dirCpm \t:: FilePath\r\r\r\n\t\t\t\t, dirClean\t:: FilePath\r\r\r\n\t\t\t\t}\r\r\r\nderive class iTask Settings\r\r\r\n\r\r\r\nsettings = sharedStore \"settings\" \t{ dirCpm = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\/cpm.exe\"\r\r\r\n\t\t\t\t\t\t\t\t\t, dirClean = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\"\r\r\r\n\t\t\t\t\t\t\t\t\t}\r\r\r\nupdSettings \r\r\r\n\t= \t\tupdateSharedInformation \"Current Setting: \" [] settings\r\r\r\n\r\r\r\nerrorstate = sharedStore \"errors\" \"\"\r\r\r\n\r\r\r\n\/\/ utility functions\r\r\r\n\r\r\r\nisCleanFile file = isMember (takeExtension file) [\"icl\", \"dcl\", \"prj\", \"abc\", \"sapl\"]\r\r\r\n\r\r\r\nselectIcon pwd _ \t = Nothing\t\/\/ don't know where to store icons yet\r\r\r\n\/*selectIcon pwd \"icl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.icl.ico\")\r\r\r\nselectIcon pwd \"dcl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.dcl.ico\")\r\r\r\nselectIcon pwd \"prj\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.prj.ico\")\r\r\r\nselectIcon pwd \"abc\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.abc.ico\")\r\r\r\nselectIcon pwd _ \t = Nothing*\/\r\r\r\n\r\r\r\n\/\/ missing operator hack for avoiding continues \r\r\r\n\r\r\r\n(>>|-) infixl 1 :: (Task a) (Task b) -> Task b | iTask a & iTask b\r\r\r\n(>>|-) ma mb = ma >>- \\_ -> mb\r\r\r\n\r\r\r\n\/\/ -------------\r\r\r\n\r\r\r\nStart :: *World -> *World\r\r\r\nStart world = startEngine (treeEdit) world\r\r\r\n\/\/Start world = startEngine ideDashboard world\r\r\r\n\r\r\r\n\/\/ ------------- to do:\r\r\r\n\r\r\r\ntreeEdit :: Task ()\/\/(({#Char},String),())\r\r\r\ntreeEdit \r\r\r\n\t=\t\t\t\t\t\t\tgetPwdName\r\r\r\n \t>>= \\pwd ->\t\t\t\t\tselectFromTree pwd isCleanFile \r\r\r\n\t>>= \\path ->\t\t\t\tviewInformation \"selected file\" [] path\r\r\r\n\t>>= \\path ->\t\t\t\treadFromFile path\r\r\r\n\t>>- \\content -> \t\t\teditFile (takeDirectory path) (dropDirectory path) content\r\r\r\n\r\r\r\n\/*\r\r\r\n\/\/# (exists,world)  = fileExists mainmodule world\r\r\r\ncreateTempFiles :: String String -> Task (String,String)\r\r\r\ncreateTempFiles path name =\r\r\r\n\taccWorld (getCurrentDirectory) >>=\r\r\r\n\t\\cur. \r\r\r\n\t(createFile (cur <\\> \"Temp\" <\\> name) \"\" -&&-\r\r\r\n\t createFile (cur <\\> \"Temp\" <\\> replaceExtension name \"prj\")\r\r\r\n*\/\r\r\r\n\r\r\r\neditor :: String String (RWShared .() {#.Char} {#.Char})-> Task {#Char}\r\r\r\neditor path name sc =\r\r\r\n\tupdateSharedInformation (path <\/> name) [UpdateUsing id (\\_ nsc -> nsc) aceTextArea] sc\r\r\r\n\r\r\r\n\/\/updaters\r\r\r\n\/\/updateEverySecond :: \r\r\r\n\r\r\r\n\/\/end updaters\r\r\r\n\r\r\r\ncpmtask :: String (RWShared () {#Char} {#Char}) -> Task ()\r\r\r\ncpmtask iclloc content = \r\r\r\n\t\t\tget currentTime >>=\r\r\r\n\t\t\t\\now.  waitForTime2 {Time| now & sec=now.Time.sec+1} >>- \\_ ->\r\r\r\n\t\t\t(saveFile iclloc content) >>- \\_ ->\r\r\r\n\t\t\tappWorld (compile prjloc) \r\r\r\n\t\t\t>>- \\_ -> readFromFile errorloc\r\r\r\n\t\t\t>>- \\errors. \r\r\r\n\t\t\tset ((toString now) +++ errors) errorstate\r\r\r\n\t\t\t>>- \\_ -> cpmtask iclloc content\r\r\r\n\twhere\r\r\r\n\tsaveFile path content \r\r\r\n\t\t= get content >>= \\c. writeToFile path c @! ()\r\r\r\n\tprjloc = replaceExtension iclloc \"prj\"\r\r\r\n\terrorloc = replaceFileName iclloc \"errors\"\r\r\r\n\r\r\r\n\/\/(ifValue (\\(a,now1).get currentTime >>= \\now2. (now2.sec > now1.sec)))\r\r\r\n\r\r\r\nwaitForTime2 :: !Time -> Task Time\r\r\r\nwaitForTime2 time =\r\r\r\n\twatch currentTime >>* [OnValue (ifValue (\\now -> time < now) return)]\r\r\r\n\r\r\r\n\r\r\r\neditFile :: String String String -> Task () \/\/(({#Char},String),())\r\r\r\neditFile path name content =\r\r\r\n\taccWorld (getCurrentDirectory) >>=\r\r\r\n\t\\(Ok cur). appWorld (createProject (cur <\/> \"Temp\" <\/> name)) >>|\r\r\r\n\twithShared content\r\r\r\n\t(\\sc ->\r\r\r\n\t \t\t(editor path name sc \r\r\r\n\t \t\t-&&-\r\r\r\n\t \t\tviewSharedInformation \"errors\" [ViewUsing id (textArea 'DM'.newMap)] errorstate) \r\r\r\n\t \t\t-&&-\r\r\r\n\t \t\t(cpmtask (cur <\/> \"Temp\" <\/> name) sc)\r\r\r\n\t >^*\t[\tOnAction  ActionSave    \t(always (get sc >>= \\content. saveFile (path <\/> (\"Edited\" +++ name)) content))\r\r\r\n\t \t\t,\tOnAction  ActionSaveAs\t\t(always (get sc >>= \\content. saveFileAs (path <\/> name)content) )\r\r\r\n\t \t\t]\r\r\r\n\t \t\t++ \r\r\r\n\t \t\tif (takeExtension name <> \"icl\") []\r\r\r\n\t \t\t[\tOnAction (Action \"Build\")\t(always (get sc>>= \\content. (const (buildProject path (dropExtension name)) content)))\r\r\r\n\t \t\t,\tOnAction (Action \"Run\")\t\t(always (runExec (path <\/> dropExtension name +++ \".exe\") 8080))\r\r\r\n\t \t\t]\r\r\r\n\t >>*\t[   OnAction  ActionQuit    \t(always (return ()))\r\r\r\n\t\t    ]\r\r\r\n\t)\r\r\r\nwhere\r\r\r\n\tsaveFile path content \r\r\r\n\t\t= writeToFile path (remove_double_enters content) @! () \r\r\r\n\t\r\r\r\n\tsaveFileAs path content \r\r\r\n\t\t= \t\tupdateInformation \"Where to write to ?\" [] path\r\r\r\n\t\t>>*\t\t[\tOnAction ActionSave\t\t(hasValue (\\name -> saveFile name content))\r\r\r\n\t\t\t \t,\tOnAction ActionCancel\t(always (return ()))\r\r\r\n\t\t\t \t]\r\r\r\n\t\t\r\r\r\n\tbuildProject buildPath iclFileName \r\r\r\n\t\t= \t\t\t\t\tget settings \r\r\r\n\t\t>>- \\curSet ->\t\tviewInformation \"Calling cpm : \" [] (curSet.dirCpm, buildPath, iclFileName)\r\r\r\n\t\t>>|\t\t\t\t\tcreateExec curSet.dirCpm buildPath iclFileName\r\r\r\n\r\r\r\nremove_double_enters :: String -> String\r\r\r\nremove_double_enters str = {c \\\\ c <-: str | c <> '\\r'}\r\r\r\n\r\r\r\n\r\r\r\n"],false],"createdAt":8,"lastEvent":8},{"taskId":["TaskId",3,2781],"index":1,"detached":false,"attributes":["Tip"],"value":["Value",["Right",""],false],"createdAt":8,"lastEvent":8}],["Tip"],["Tip"]]]]
20170323-121910["Bin",4,["TaskId",5,2812],[{"taskId":["TaskId",5,2813],"index":0,"detached":false,"attributes":["Tip"],"value":["NoValue"],"createdAt":6,"lastEvent":6}],["Bin",1,["TaskId",5,2792],[],["Tip"],["Tip"]],["Bin",2,["TaskId",5,2813],[{"taskId":["TaskId",5,2814],"index":0,"detached":false,"attributes":["Tip"],"value":["Value",["Left",["module EditedwebIDE\r\r\r\r\r\r\r\r\r\rimport iTasks\r\r\r\r\r\r\r\r\r\rimport Text\r\r\r\r\rimport iTasks.API.Extensions.Admin.WorkflowAdmin\r\r\r\r\rimport iTasks.UI.Layout, iTasks.UI.Definition, iTasks.UI.Editor.Builtin\r\r\r\r\rimport iTasks.API.Extensions.Editors.Ace\r\r\r\r\rimport StdFile, System.File\r\r\r\r\rimport System.Directory\r\r\r\r\rimport System.FilePath\r\r\r\r\rimport _SystemArray\r\r\r\r\rimport Data.Error\r\r\r\r\rimport qualified Data.Map as DM\r\r\r\r\r\r\r\r\r\rimport createAndRunExec\r\r\r\r\rimport directoryBrowsing\r\r\r\r\r\r\r\r\r\rimport CpmLogic2\r\r\r\r\r\r\r\r\r\r\/\/ -------------\r\r\r\r\rimport qualified Data.Map as DM\r\r\r\r\r:: Settings = \t{ dirCpm \t:: FilePath\r\r\r\r\r\t\t\t\t, dirClean\t:: FilePath\r\r\r\r\r\t\t\t\t}\r\r\r\r\rderive class iTask Settings\r\r\r\r\r\r\r\r\r\rsettings = sharedStore \"settings\" \t{ dirCpm = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\/cpm.exe\"\r\r\r\r\r\t\t\t\t\t\t\t\t\t, dirClean = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\"\r\r\r\r\r\t\t\t\t\t\t\t\t\t}\r\r\r\r\rupdSettings \r\r\r\r\r\t= \t\tupdateSharedInformation \"Current Setting: \" [] settings\r\r\r\r\r\r\r\r\r\rerrorstate = sharedStore \"errors\" \"\"\r\r\r\r\r\r\r\r\r\r\/\/ utility functions\r\r\r\r\r\r\r\r\r\risCleanFile file = isMember (takeExtension file) [\"icl\", \"dcl\", \"prj\", \"abc\", \"sapl\"]\r\r\r\r\r\r\r\r\r\rselectIcon pwd _ \t = Nothing\t\/\/ don't know where to store icons yet\r\r\r\r\r\/*selectIcon pwd \"icl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.icl.ico\")\r\r\r\r\rselectIcon pwd \"dcl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.dcl.ico\")\r\r\r\r\rselectIcon pwd \"prj\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.prj.ico\")\r\r\r\r\rselectIcon pwd \"abc\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.abc.ico\")\r\r\r\r\rselectIcon pwd _ \t = Nothing*\/\r\r\r\r\r\r\r\r\r\r\/\/ missing operator hack for avoiding continues \r\r\r\r\r\r\r\r\r\r(>>|-) infixl 1 :: (Task a) (Task b) -> Task b | iTask a & iTask b\r\r\r\r\r(>>|-) ma mb = ma >>- \\_ -> mb\r\r\r\r\r\r\r\r\r\r\/\/ -------------\r\r\r\r\r\r\r\r\r\rStart :: *World -> *World\r\r\r\r\rStart world = startEngine (treeEdit) world\r\r\r\r\r\/\/Start world = startEngine ideDashboard world\r\r\r\r\r\r\r\r\r\r\/\/ ------------- to do:\r\r\r\r\r\r\r\r\r\rtreeEdit :: Task ()\/\/(({#Char},String),())\r\r\r\r\rtreeEdit \r\r\r\r\r\t=\t\t\t\t\t\t\tgetPwdName\r\r\r\r\r \t>>= \\pwd ->\t\t\t\t\tselectFromTree pwd isCleanFile \r\r\r\r\r\t>>= \\path ->\t\t\t\tviewInformation \"selected file\" [] path\r\r\r\r\r\t>>= \\path ->\t\t\t\treadFromFile path\r\r\r\r\r\t>>- \\content -> \t\t\teditFile (takeDirectory path) (dropDirectory path) content\r\r\r\r\r\r\r\r\r\r\/*\r\r\r\r\r\/\/# (exists,world)  = fileExists mainmodule world\r\r\r\r\rcreateTempFiles :: String String -> Task (String,String)\r\r\r\r\rcreateTempFiles path name =\r\r\r\r\r\taccWorld (getCurrentDirectory) >>=\r\r\r\r\r\t\\cur. \r\r\r\r\r\t(createFile (cur <\\> \"Temp\" <\\> name) \"\" -&&-\r\r\r\r\r\t createFile (cur <\\> \"Temp\" <\\> replaceExtension name \"prj\")\r\r\r\r\r*\/\r\r\r\r\r\r\r\r\r\reditor :: String String (RWShared .() {#.Char} {#.Char})-> Task {#Char}\r\r\r\r\reditor path name sc =\r\r\r\r\r\tupdateSharedInformation (path <\/> name) [UpdateUsing id (\\_ nsc -> nsc) aceTextArea] sc\r\r\r\r\r\r\r\r\r\r\/\/updaters\r\r\r\r\r\/\/updateEverySecond :: \r\r\r\r\r\r\r\r\r\r\/\/end updaters\r\r\r\r\r\r\r\r\r\rcpmtask :: String (RWShared () {#Char} {#Char}) -> Task ()\r\r\r\r\rcpmtask iclloc content = \r\r\r\r\r\t\t\tget currentTime >>=\r\r\r\r\r\t\t\t\\now.  waitForTime2 {Time| now & sec=now.Time.sec+1} >>- \\_ ->\r\r\r\r\r\t\t\t(saveFile iclloc content) >>- \\_ ->\r\r\r\r\r\t\t\tappWorld (compile prjloc) \r\r\r\r\r\t\t\t>>- \\_ -> readFromFile errorloc\r\r\r\r\r\t\t\t>>- \\errors. \r\r\r\r\r\t\t\tset ((toString now) +++ errors) errorstate\r\r\r\r\r\t\t\t>>- \\_ -> cpmtask iclloc content\r\r\r\r\r\twhere\r\r\r\r\r\tsaveFile path content \r\r\r\r\r\t\t= get content >>= \\c. writeToFile path c @! ()\r\r\r\r\r\tprjloc = replaceExtension iclloc \"prj\"\r\r\r\r\r\terrorloc = replaceFileName iclloc \"errors\"\r\r\r\r\r\r\r\r\r\r\/\/(ifValue (\\(a,now1).get currentTime >>= \\now2. (now2.sec > now1.sec)))\r\r\r\r\r\r\r\r\r\rwaitForTime2 :: !Time -> Task Time\r\r\r\r\rwaitForTime2 time =\r\r\r\r\r\twatch currentTime >>* [OnValue (ifValue (\\now -> time < now) return)]\r\r\r\r\r\r\r\r\r\r\r\r\r\r\reditFile :: String String String -> Task () \/\/(({#Char},String),())\r\r\r\r\reditFile path name content =\r\r\r\r\r\taccWorld (getCurrentDirectory) >>=\r\r\r\r\r\t\\(Ok cur). appWorld (createProject (cur <\/> \"Temp\" <\/> name)) >>|\r\r\r\r\r\twithShared content\r\r\r\r\r\t(\\sc ->\r\r\r\r\r\t \t\t(editor path name sc \r\r\r\r\r\t \t\t-&&-\r\r\r\r\r\t \t\tviewSharedInformation \"errors\" [ViewUsing id (textArea 'DM'.newMap)] errorstate) \r\r\r\r\r\t \t\t-&&-\r\r\r\r\r\t \t\t(cpmtask (cur <\/> \"Temp\" <\/> name) sc)\r\r\r\r\r\t >^*\t[\tOnAction  ActionSave    \t(always (get sc >>= \\content. saveFile (path <\/> (\"Edited\" +++ name)) content))\r\r\r\r\r\t \t\t,\tOnAction  ActionSaveAs\t\t(always (get sc >>= \\content. saveFileAs (path <\/> name)content) )\r\r\r\r\r\t \t\t]\r\r\r\r\r\t \t\t++ \r\r\r\r\r\t \t\tif (takeExtension name <> \"icl\") []\r\r\r\r\r\t \t\t[\tOnAction (Action \"Build\")\t(always (get sc>>= \\content. (const (buildProject path (dropExtension name)) content)))\r\r\r\r\r\t \t\t,\tOnAction (Action \"Run\")\t\t(always (runExec (path <\/> dropExtension name +++ \".exe\") 8080))\r\r\r\r\r\t \t\t]\r\r\r\r\r\t >>*\t[   OnAction  ActionQuit    \t(always (return ()))\r\r\r\r\r\t\t    ]\r\r\r\r\r\t)\r\r\r\r\rwhere\r\r\r\r\r\tsaveFile path content \r\r\r\r\r\t\t= writeToFile path (remove_double_enters content) @! () \r\r\r\r\r\t\r\r\r\r\r\tsaveFileAs path content \r\r\r\r\r\t\t= \t\tupdateInformation \"Where to write to ?\" [] path\r\r\r\r\r\t\t>>*\t\t[\tOnAction ActionSave\t\t(hasValue (\\name -> saveFile name content))\r\r\r\r\r\t\t\t \t,\tOnAction ActionCancel\t(always (return ()))\r\r\r\r\r\t\t\t \t]\r\r\r\r\r\t\t\r\r\r\r\r\tbuildProject buildPath iclFileName \r\r\r\r\r\t\t= \t\t\t\t\tget settings \r\r\r\r\r\t\t>>- \\curSet ->\t\tviewInformation \"Calling cpm : \" [] (curSet.dirCpm, buildPath, iclFileName)\r\r\r\r\r\t\t>>|\t\t\t\t\tcreateExec curSet.dirCpm buildPath iclFileName\r\r\r\r\r\r\r\r\r\rremove_double_enters :: String -> String\r\r\r\r\rremove_double_enters str = {c \\\\ c <-: str | c <> '\\r'}\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r","Bring up to date...\r\nCompiling...\r\nAnalyzing 'EditedwebIDE'. \r\n[EditedwebIDE.icl,]: no abc file\r\nCompiling 'EditedwebIDE'.\r\nError [EditedwebIDE.icl,11]: iTasks.dcl could not be imported\r\nError [EditedwebIDE.icl,21]: Text.dcl could not be imported\r\nError [EditedwebIDE.icl,26]: iTasks.API.Extensions.Admin.WorkflowAdmin.dcl could not be imported\r\nError [EditedwebIDE.icl,31]: iTasks.UI.Layout.dcl could not be imported\r\nError [EditedwebIDE.icl,31]: iTasks.UI.Definition.dcl could not be imported\r\nError [EditedwebIDE.icl,31]: iTasks.UI.Editor.Builtin.dcl could not be imported\r\nError [EditedwebIDE.icl,36]: iTasks.API.Extensions.Editors.Ace.dcl could not be imported\r\nError [EditedwebIDE.icl,41]: System.File.dcl could not be imported\r\nError [EditedwebIDE.icl,46]: System.Directory.dcl could not be imported\r\nError [EditedwebIDE.icl,51]: System.FilePath.dcl could not be imported\r\nError [EditedwebIDE.icl,61]: Data.Error.dcl could not be imported\r\nError [EditedwebIDE.icl,66]: Data.Map.dcl could not be imported\r\nError [EditedwebIDE.icl,91]: CpmLogic2.dcl could not be imported\r\nLinking...\r\nFinished making.\r\n"]],false],"createdAt":6,"lastEvent":6},{"taskId":["TaskId",5,2815],"index":1,"detached":false,"attributes":["Tip"],"value":["NoValue"],"createdAt":6,"lastEvent":6}],["Tip"],["Bin",1,["TaskId",5,2814],[{"taskId":["TaskId",5,2816],"index":0,"detached":false,"attributes":["Tip"],"value":["Value",["Left","module EditedwebIDE\r\r\r\r\r\r\r\r\r\rimport iTasks\r\r\r\r\r\r\r\r\r\rimport Text\r\r\r\r\rimport iTasks.API.Extensions.Admin.WorkflowAdmin\r\r\r\r\rimport iTasks.UI.Layout, iTasks.UI.Definition, iTasks.UI.Editor.Builtin\r\r\r\r\rimport iTasks.API.Extensions.Editors.Ace\r\r\r\r\rimport StdFile, System.File\r\r\r\r\rimport System.Directory\r\r\r\r\rimport System.FilePath\r\r\r\r\rimport _SystemArray\r\r\r\r\rimport Data.Error\r\r\r\r\rimport qualified Data.Map as DM\r\r\r\r\r\r\r\r\r\rimport createAndRunExec\r\r\r\r\rimport directoryBrowsing\r\r\r\r\r\r\r\r\r\rimport CpmLogic2\r\r\r\r\r\r\r\r\r\r\/\/ -------------\r\r\r\r\rimport qualified Data.Map as DM\r\r\r\r\r:: Settings = \t{ dirCpm \t:: FilePath\r\r\r\r\r\t\t\t\t, dirClean\t:: FilePath\r\r\r\r\r\t\t\t\t}\r\r\r\r\rderive class iTask Settings\r\r\r\r\r\r\r\r\r\rsettings = sharedStore \"settings\" \t{ dirCpm = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\/cpm.exe\"\r\r\r\r\r\t\t\t\t\t\t\t\t\t, dirClean = \"C:\/Users\/Martin\/Documents\/clean-classic-itasks-windows-x86-20161223\"\r\r\r\r\r\t\t\t\t\t\t\t\t\t}\r\r\r\r\rupdSettings \r\r\r\r\r\t= \t\tupdateSharedInformation \"Current Setting: \" [] settings\r\r\r\r\r\r\r\r\r\rerrorstate = sharedStore \"errors\" \"\"\r\r\r\r\r\r\r\r\r\r\/\/ utility functions\r\r\r\r\r\r\r\r\r\risCleanFile file = isMember (takeExtension file) [\"icl\", \"dcl\", \"prj\", \"abc\", \"sapl\"]\r\r\r\r\r\r\r\r\r\rselectIcon pwd _ \t = Nothing\t\/\/ don't know where to store icons yet\r\r\r\r\r\/*selectIcon pwd \"icl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.icl.ico\")\r\r\r\r\rselectIcon pwd \"dcl\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.dcl.ico\")\r\r\r\r\rselectIcon pwd \"prj\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.prj.ico\")\r\r\r\r\rselectIcon pwd \"abc\" = Just (pwd <\/> \"WebPublic\" <\/> \"Clean.abc.ico\")\r\r\r\r\rselectIcon pwd _ \t = Nothing*\/\r\r\r\r\r\r\r\r\r\r\/\/ missing operator hack for avoiding continues \r\r\r\r\r\r\r\r\r\r(>>|-) infixl 1 :: (Task a) (Task b) -> Task b | iTask a & iTask b\r\r\r\r\r(>>|-) ma mb = ma >>- \\_ -> mb\r\r\r\r\r\r\r\r\r\r\/\/ -------------\r\r\r\r\r\r\r\r\r\rStart :: *World -> *World\r\r\r\r\rStart world = startEngine (treeEdit) world\r\r\r\r\r\/\/Start world = startEngine ideDashboard world\r\r\r\r\r\r\r\r\r\r\/\/ ------------- to do:\r\r\r\r\r\r\r\r\r\rtreeEdit :: Task ()\/\/(({#Char},String),())\r\r\r\r\rtreeEdit \r\r\r\r\r\t=\t\t\t\t\t\t\tgetPwdName\r\r\r\r\r \t>>= \\pwd ->\t\t\t\t\tselectFromTree pwd isCleanFile \r\r\r\r\r\t>>= \\path ->\t\t\t\tviewInformation \"selected file\" [] path\r\r\r\r\r\t>>= \\path ->\t\t\t\treadFromFile path\r\r\r\r\r\t>>- \\content -> \t\t\teditFile (takeDirectory path) (dropDirectory path) content\r\r\r\r\r\r\r\r\r\r\/*\r\r\r\r\r\/\/# (exists,world)  = fileExists mainmodule world\r\r\r\r\rcreateTempFiles :: String String -> Task (String,String)\r\r\r\r\rcreateTempFiles path name =\r\r\r\r\r\taccWorld (getCurrentDirectory) >>=\r\r\r\r\r\t\\cur. \r\r\r\r\r\t(createFile (cur <\\> \"Temp\" <\\> name) \"\" -&&-\r\r\r\r\r\t createFile (cur <\\> \"Temp\" <\\> replaceExtension name \"prj\")\r\r\r\r\r*\/\r\r\r\r\r\r\r\r\r\reditor :: String String (RWShared .() {#.Char} {#.Char})-> Task {#Char}\r\r\r\r\reditor path name sc =\r\r\r\r\r\tupdateSharedInformation (path <\/> name) [UpdateUsing id (\\_ nsc -> nsc) aceTextArea] sc\r\r\r\r\r\r\r\r\r\r\/\/updaters\r\r\r\r\r\/\/updateEverySecond :: \r\r\r\r\r\r\r\r\r\r\/\/end updaters\r\r\r\r\r\r\r\r\r\rcpmtask :: String (RWShared () {#Char} {#Char}) -> Task ()\r\r\r\r\rcpmtask iclloc content = \r\r\r\r\r\t\t\tget currentTime >>=\r\r\r\r\r\t\t\t\\now.  waitForTime2 {Time| now & sec=now.Time.sec+1} >>- \\_ ->\r\r\r\r\r\t\t\t(saveFile iclloc content) >>- \\_ ->\r\r\r\r\r\t\t\tappWorld (compile prjloc) \r\r\r\r\r\t\t\t>>- \\_ -> readFromFile errorloc\r\r\r\r\r\t\t\t>>- \\errors. \r\r\r\r\r\t\t\tset ((toString now) +++ errors) errorstate\r\r\r\r\r\t\t\t>>- \\_ -> cpmtask iclloc content\r\r\r\r\r\twhere\r\r\r\r\r\tsaveFile path content \r\r\r\r\r\t\t= get content >>= \\c. writeToFile path c @! ()\r\r\r\r\r\tprjloc = replaceExtension iclloc \"prj\"\r\r\r\r\r\terrorloc = replaceFileName iclloc \"errors\"\r\r\r\r\r\r\r\r\r\r\/\/(ifValue (\\(a,now1).get currentTime >>= \\now2. (now2.sec > now1.sec)))\r\r\r\r\r\r\r\r\r\rwaitForTime2 :: !Time -> Task Time\r\r\r\r\rwaitForTime2 time =\r\r\r\r\r\twatch currentTime >>* [OnValue (ifValue (\\now -> time < now) return)]\r\r\r\r\r\r\r\r\r\r\r\r\r\r\reditFile :: String String String -> Task () \/\/(({#Char},String),())\r\r\r\r\reditFile path name content =\r\r\r\r\r\taccWorld (getCurrentDirectory) >>=\r\r\r\r\r\t\\(Ok cur). appWorld (createProject (cur <\/> \"Temp\" <\/> name)) >>|\r\r\r\r\r\twithShared content\r\r\r\r\r\t(\\sc ->\r\r\r\r\r\t \t\t(editor path name sc \r\r\r\r\r\t \t\t-&&-\r\r\r\r\r\t \t\tviewSharedInformation \"errors\" [ViewUsing id (textArea 'DM'.newMap)] errorstate) \r\r\r\r\r\t \t\t-&&-\r\r\r\r\r\t \t\t(cpmtask (cur <\/> \"Temp\" <\/> name) sc)\r\r\r\r\r\t >^*\t[\tOnAction  ActionSave    \t(always (get sc >>= \\content. saveFile (path <\/> (\"Edited\" +++ name)) content))\r\r\r\r\r\t \t\t,\tOnAction  ActionSaveAs\t\t(always (get sc >>= \\content. saveFileAs (path <\/> name)content) )\r\r\r\r\r\t \t\t]\r\r\r\r\r\t \t\t++ \r\r\r\r\r\t \t\tif (takeExtension name <> \"icl\") []\r\r\r\r\r\t \t\t[\tOnAction (Action \"Build\")\t(always (get sc>>= \\content. (const (buildProject path (dropExtension name)) content)))\r\r\r\r\r\t \t\t,\tOnAction (Action \"Run\")\t\t(always (runExec (path <\/> dropExtension name +++ \".exe\") 8080))\r\r\r\r\r\t \t\t]\r\r\r\r\r\t >>*\t[   OnAction  ActionQuit    \t(always (return ()))\r\r\r\r\r\t\t    ]\r\r\r\r\r\t)\r\r\r\r\rwhere\r\r\r\r\r\tsaveFile path content \r\r\r\r\r\t\t= writeToFile path (remove_double_enters content) @! () \r\r\r\r\r\t\r\r\r\r\r\tsaveFileAs path content \r\r\r\r\r\t\t= \t\tupdateInformation \"Where to write to ?\" [] path\r\r\r\r\r\t\t>>*\t\t[\tOnAction ActionSave\t\t(hasValue (\\name -> saveFile name content))\r\r\r\r\r\t\t\t \t,\tOnAction ActionCancel\t(always (return ()))\r\r\r\r\r\t\t\t \t]\r\r\r\r\r\t\t\r\r\r\r\r\tbuildProject buildPath iclFileName \r\r\r\r\r\t\t= \t\t\t\t\tget settings \r\r\r\r\r\t\t>>- \\curSet ->\t\tviewInformation \"Calling cpm : \" [] (curSet.dirCpm, buildPath, iclFileName)\r\r\r\r\r\t\t>>|\t\t\t\t\tcreateExec curSet.dirCpm buildPath iclFileName\r\r\r\r\r\r\r\r\r\rremove_double_enters :: String -> String\r\r\r\r\rremove_double_enters str = {c \\\\ c <-: str | c <> '\\r'}\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r"],false],"createdAt":6,"lastEvent":6},{"taskId":["TaskId",5,2817],"index":1,"detached":false,"attributes":["Tip"],"value":["Value",["Right","Bring up to date...\r\nCompiling...\r\nAnalyzing 'EditedwebIDE'. \r\n[EditedwebIDE.icl,]: no abc file\r\nCompiling 'EditedwebIDE'.\r\nError [EditedwebIDE.icl,11]: iTasks.dcl could not be imported\r\nError [EditedwebIDE.icl,21]: Text.dcl could not be imported\r\nError [EditedwebIDE.icl,26]: iTasks.API.Extensions.Admin.WorkflowAdmin.dcl could not be imported\r\nError [EditedwebIDE.icl,31]: iTasks.UI.Layout.dcl could not be imported\r\nError [EditedwebIDE.icl,31]: iTasks.UI.Definition.dcl could not be imported\r\nError [EditedwebIDE.icl,31]: iTasks.UI.Editor.Builtin.dcl could not be imported\r\nError [EditedwebIDE.icl,36]: iTasks.API.Extensions.Editors.Ace.dcl could not be imported\r\nError [EditedwebIDE.icl,41]: System.File.dcl could not be imported\r\nError [EditedwebIDE.icl,46]: System.Directory.dcl could not be imported\r\nError [EditedwebIDE.icl,51]: System.FilePath.dcl could not be imported\r\nError [EditedwebIDE.icl,61]: Data.Error.dcl could not be imported\r\nError [EditedwebIDE.icl,66]: Data.Map.dcl could not be imported\r\nError [EditedwebIDE.icl,91]: CpmLogic2.dcl could not be imported\r\nLinking...\r\nFinished making.\r\n"],false],"createdAt":6,"lastEvent":6}],["Tip"],["Tip"]]]]
|| ?module? iTasks._Framework.WebService


iTasks._Framework.WebService.onConnect_32 host_0 r_1 !iworld_2 = case iworld_2 (iTasks._Framework.IWorld._IWorld server_1_0 config_1_1 clocks_1_2 current_1_3 random_1_4 sdsNotifyRequests_1_5 memoryShares_1_6 cachedShares_1_7 exposedShares_1_8 jsCompilerState_1_9 ioTasks_1_10 ioStates_1_11 world_1_12 resources_1_13 onClient_1_14 shutdown_1_15 -> _Tuple5 (Data.Error.Ok (iTasks._Framework.WebService.NTIdle host_0 (select clocks_1_2::iTasks._Framework.IWorld._SystemClocks 0))) Data.Maybe.Nothing _predefined._Nil False (update iworld_2::iTasks._Framework.IWorld._IWorld [12:world_1_12])) 
iTasks._Framework.WebService.selectHandler_35 req_0 !_x_1 = case _x_1 (_predefined._Nil -> Data.Maybe.Nothing) (_predefined._Cons h_1_0 hs_1_1 -> case h_1_0 (_Tuple5 pred_2_0 _x_2_1 _x_2_2 _x_2_3 _x_2_4 -> case (pred_2_0 (select req_0::Internet.HTTP._HTTPRequest 1)) (True -> Data.Maybe.Just h_1_0) (False -> iTasks._Framework.WebService.selectHandler_35 req_0 hs_1_1) ) ) 
<{iTasks._Framework.WebService.get`_73}> !<{_v<_0}> _x_1 !_x_2 = case _x_2 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 _x_1 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_73}> <{_v<_0}> _x_1 l_1_3) (False -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 kx_1_1 _x_1) (True -> <{iTasks._Framework.WebService.get`_73}> <{_v<_0}> _x_1 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
iTasks._Framework.WebService.anon_30::B !h_0 = <{StdString.==_2}> (Text.toLowerCase_16 h_0) "keep-alive"
<{iTasks._Framework.WebService.get`_454}> _x_0 !_x_1 = case _x_1 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (<{StdString.<_3}> _x_0 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_454}> _x_0 l_1_3) (False -> case (<{StdString.<_3}> kx_1_1 _x_0) (True -> <{iTasks._Framework.WebService.get`_454}> _x_0 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
iTasks._Framework.WebService.isKeepAlive_36::B !request_0 = Data.Maybe.maybe (<{StdString.==_2}> (select request_0::Internet.HTTP._HTTPRequest 3) "HTTP/1.1") iTasks._Framework.WebService.anon_30 (<{iTasks._Framework.WebService.get`_454}> "Connection" (select request_0::Internet.HTTP._HTTPRequest 5))
iTasks._Framework.WebService.addDefault_31 !<{_v==_0}> headers_1 hdr_2 val_3 = case (<{iTasks._Framework.WebService._c;235;71_483}> (Data.List.lookup <{_v==_0}> hdr_2 headers_1)) (True -> _predefined._Cons (_Tuple2 hdr_2 val_3) headers_1) (False -> headers_1) 
<{iTasks._Framework.WebService._c;235;71_483}>::B !_x_0 = case _x_0 (Data.Maybe.Nothing -> True) (_ -> False)
iTasks._Framework.WebService.addDefault_455 headers_0 hdr_1 val_2 = case (<{iTasks._Framework.WebService._c;235;71_484}> (Data.List.lookup (<{StdOverloaded.==;}> <{StdString.==_2}>) hdr_1 headers_0)) (True -> _predefined._Cons (_Tuple2 hdr_1 val_2) headers_0) (False -> headers_0) 
<{iTasks._Framework.WebService._c;235;71_484}>::B !_x_0 = case _x_0 (Data.Maybe.Nothing -> True) (_ -> False)
iTasks._Framework.WebService.encodeResponse_37 autoContentLength_0::B !response_1 = case response_1 (Internet.HTTP._HTTPResponse rsp_code_1_0 rsp_reason_1_1 rsp_headers_1_2 rsp_data_1_3 -> Internet.HTTP.toString_19 (update response_1::Internet.HTTP._HTTPResponse [2:<{iTasks._Framework.WebService._if;230;25_485}> autoContentLength_0 rsp_headers_1_2 rsp_data_1_3])) 
<{iTasks._Framework.WebService._if;230;25_485}> !autoContentLength_0::B rsp_headers_1 rsp_data_2 = case autoContentLength_0 (True -> iTasks._Framework.WebService.addDefault_455 (iTasks._Framework.WebService.addDefault_455 (iTasks._Framework.WebService.addDefault_455 rsp_headers_1 "Server" "iTasks HTTP Server") "Content-Type" "text/html") "Content-Length" (StdString.toString_5 (_SystemArray.size_20 rsp_data_2))) (_ -> iTasks._Framework.WebService.addDefault_455 (iTasks._Framework.WebService.addDefault_455 rsp_headers_1 "Server" "iTasks HTTP Server") "Content-Type" "text/html")
iTasks._Framework.WebService.whileConnected_33 keepAliveTime_0::I port_1::I requestProcessHandlers_2 mbData_3 !connState_4 r_5 env_6 = case connState_4 (iTasks._Framework.WebService.NTProcessingRequest request_1_0 localState_1_1 -> <{iTasks._Framework.WebService._c;146;11_486}> (iTasks._Framework.WebService.selectHandler_35 request_1_0 requestProcessHandlers_2) request_1_0 r_5 mbData_3 localState_1_1 env_6 connState_4) (_ -> case mbData_3 (Data.Maybe.Just data_1_0 -> case env_6 (iTasks._Framework.IWorld._IWorld server_2_0 config_2_1 clocks_2_2 current_2_3 random_2_4 sdsNotifyRequests_2_5 memoryShares_2_6 cachedShares_2_7 exposedShares_2_8 jsCompilerState_2_9 ioTasks_2_10 ioStates_2_11 world_2_12 resources_2_13 onClient_2_14 shutdown_2_15 -> let rstate_3_0 = <{iTasks._Framework.WebService._c;157;20_487}> connState_4 port_1 data_1_0 in case (select rstate_3_0::iTasks._Framework.WebService._HttpReqState 4) (True -> _Tuple5 (Data.Error.Ok connState_4) Data.Maybe.Nothing (_predefined._Cons "HTTP/1.1 400 Bad Request\r\n\r\n" _predefined._Nil) True env_6) (False -> case (StdBool.not (select rstate_3_0::iTasks._Framework.WebService._HttpReqState 2)) (True -> _Tuple5 (Data.Error.Ok (iTasks._Framework.WebService.NTReadingRequest rstate_3_0)) Data.Maybe.Nothing _predefined._Nil False env_6) (False -> <{iTasks._Framework.WebService._c;176;11_493}> (iTasks._Framework.WebService.selectHandler_35 (select rstate_3_0::iTasks._Framework.WebService._HttpReqState 0) requestProcessHandlers_2) connState_4 env_6 rstate_3_0 r_5 clocks_2_2) ) ) ) (Data.Maybe.Nothing -> case connState_4 (iTasks._Framework.WebService.NTIdle ip_2_0 _x_2_1 -> case _x_2_1 (System.Time.Timestamp t_3_0 -> case env_6 (iTasks._Framework.IWorld._IWorld server_4_0 config_4_1 clocks_4_2 current_4_3 random_4_4 sdsNotifyRequests_4_5 memoryShares_4_6 cachedShares_4_7 exposedShares_4_8 jsCompilerState_4_9 ioTasks_4_10 ioStates_4_11 world_4_12 resources_4_13 onClient_4_14 shutdown_4_15 -> case clocks_4_2 (iTasks._Framework.IWorld._SystemClocks _x_5_0 localDate_5_1 localTime_5_2 utcDate_5_3 utcTime_5_4 -> case _x_5_0 (System.Time.Timestamp now_6_0 -> _Tuple5 (Data.Error.Ok connState_4) Data.Maybe.Nothing _predefined._Nil (StdBool.not (<{StdInt.<_17}> now_6_0 (<{StdInt.+_6}> t_3_0 keepAliveTime_0))) env_6) ) ) ) ) (_ -> _Tuple5 (Data.Error.Ok connState_4) Data.Maybe.Nothing _predefined._Nil False env_6)) )
<{iTasks._Framework.WebService._c;176;11_493}> !_x_0 connState_1 env_2 rstate_3 r_4 clocks_5 = case _x_0 (Data.Maybe.Nothing -> _Tuple5 (Data.Error.Ok connState_1) Data.Maybe.Nothing (_predefined._Cons "HTTP/1.1 404 Not Found\r\n\r\n" _predefined._Nil) True env_2) (Data.Maybe.Just _x_1_0 -> case _x_1_0 (_Tuple5 _x_2_0 completeRequest_2_1 newReqHandler_2_2 procReqHandler_2_3 _x_2_4 -> case (case (select rstate_3::iTasks._Framework.WebService._HttpReqState 3) (True -> True) (False -> StdBool.not completeRequest_2_1) ) (True -> let request_4_0 = <{iTasks._Framework.WebService._if;182;35_488}> completeRequest_2_1 rstate_3, _x_4_1 = newReqHandler_2_2 request_4_0 r_4 env_2, iworld_4_2 = select _x_4_1::_Tuple4 3, mbW_4_3 = select _x_4_1::_Tuple4 2, response_4_4 = select _x_4_1::_Tuple4 0 in <{iTasks._Framework.WebService._c;190;23_492}> (select _x_4_1::_Tuple4 1) request_4_0 rstate_3 clocks_5 mbW_4_3 response_4_4 iworld_4_2 connState_1) (False -> _Tuple5 (Data.Error.Ok (iTasks._Framework.WebService.NTReadingRequest rstate_3)) Data.Maybe.Nothing _predefined._Nil False env_2) ) ) 
<{iTasks._Framework.WebService._c;190;23_492}> !_x_0 request_1 rstate_2 clocks_3 mbW_4 response_5 iworld_6 connState_7 = case _x_0 (Data.Maybe.Nothing -> let keepalive_2_0::B = iTasks._Framework.WebService.isKeepAlive_36 request_1 in case keepalive_2_0 (True -> _Tuple5 (Data.Error.Ok (iTasks._Framework.WebService.NTIdle (select (select rstate_2::iTasks._Framework.WebService._HttpReqState 0)::Internet.HTTP._HTTPRequest 13) (select clocks_3::iTasks._Framework.IWorld._SystemClocks 0))) mbW_4 (_predefined._Cons (iTasks._Framework.WebService.encodeResponse_37 True (<{iTasks._Framework.WebService._if;188;35_489}> keepalive_2_0 response_5)) _predefined._Nil) False iworld_6) (False -> _Tuple5 (Data.Error.Ok connState_7) mbW_4 (_predefined._Cons (iTasks._Framework.WebService.encodeResponse_37 True (<{iTasks._Framework.WebService._if;188;35_490}> keepalive_2_0 response_5)) _predefined._Nil) True iworld_6) ) (Data.Maybe.Just localState_1_0 -> _Tuple5 (Data.Error.Ok (iTasks._Framework.WebService.NTProcessingRequest request_1 localState_1_0)) mbW_4 (_predefined._Cons (iTasks._Framework.WebService.encodeResponse_37 False (<{iTasks._Framework.WebService._if;188;35_491}> (iTasks._Framework.WebService.isKeepAlive_36 request_1) response_5)) _predefined._Nil) False iworld_6) 
<{iTasks._Framework.WebService._if;188;35_491}> !_x_0::B !response_1 = case _x_0 (True -> update response_1::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Connection" "Keep-Alive") (select response_1::Internet.HTTP._HTTPResponse 2)]) (_ -> response_1)
<{iTasks._Framework.WebService._if;188;35_490}> !keepalive_0::B !response_1 = case keepalive_0 (True -> update response_1::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Connection" "Keep-Alive") (select response_1::Internet.HTTP._HTTPResponse 2)]) (_ -> response_1)
<{iTasks._Framework.WebService._if;188;35_489}> !keepalive_0::B !response_1 = case keepalive_0 (True -> update response_1::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Connection" "Keep-Alive") (select response_1::Internet.HTTP._HTTPResponse 2)]) (_ -> response_1)
<{iTasks._Framework.WebService._if;182;35_488}> !completeRequest_0::B !rstate_1 = case completeRequest_0 (True -> iTasks._Framework.HttpUtil.http_parseArguments (select rstate_1::iTasks._Framework.WebService._HttpReqState 0)) (_ -> select rstate_1::iTasks._Framework.WebService._HttpReqState 0)
<{iTasks._Framework.WebService._c;157;20_487}> !connState_0 port_1::I data_2 = case connState_0 (iTasks._Framework.WebService.NTIdle client_name_1_0 _x_1_1 -> let _x_2_0 = iTasks._Framework.HttpUtil.http_addRequestData (update Internet.HTTP.newHTTPRequest::Internet.HTTP._HTTPRequest [12:port_1,13:client_name_1_0]) False False False data_2 in iTasks._Framework.WebService._HttpReqState (select _x_2_0::_Tuple5 0) (select _x_2_0::_Tuple5 1) (select _x_2_0::_Tuple5 2) (select _x_2_0::_Tuple5 3) (select _x_2_0::_Tuple5 4)) (iTasks._Framework.WebService.NTReadingRequest _x_1_0 -> case _x_1_0 (iTasks._Framework.WebService._HttpReqState request_2_0 method_done_2_1 headers_done_2_2 data_done_2_3 error_2_4 -> let _x_3_0 = iTasks._Framework.HttpUtil.http_addRequestData request_2_0 method_done_2_1 headers_done_2_2 data_done_2_3 (StdString.toString_9 data_2) in iTasks._Framework.WebService._HttpReqState (select _x_3_0::_Tuple5 0) (select _x_3_0::_Tuple5 1) (select _x_3_0::_Tuple5 2) (select _x_3_0::_Tuple5 3) (select _x_3_0::_Tuple5 4)) ) (_ -> iTasks._Framework.WebService._HttpReqState Internet.HTTP.newHTTPRequest False False False True)
<{iTasks._Framework.WebService._c;146;11_486}> !_x_0 request_1 r_2 mbData_3 localState_4 env_5 connState_6 = case _x_0 (Data.Maybe.Just _x_1_0 -> case _x_1_0 (_Tuple5 _x_2_0 _x_2_1 _x_2_2 handler_2_3 _x_2_4 -> let _x_3_0::B = handler_2_3 request_1 r_2 mbData_3 localState_4 env_5, done_3_1 = select _x_3_0::_Tuple5 1 in case (case done_3_1 (True -> iTasks._Framework.WebService.isKeepAlive_36 request_1) (False -> False) ) (True -> let env_5_0 = select _x_3_0::_Tuple5 4 in _Tuple5 (Data.Error.Ok (iTasks._Framework.WebService.NTIdle (select request_1::Internet.HTTP._HTTPRequest 13) (select (select env_5_0::iTasks._Framework.IWorld._IWorld 2)::iTasks._Framework.IWorld._SystemClocks 0))) (select _x_3_0::_Tuple5 3) (select _x_3_0::_Tuple5 0) False (update env_5_0::iTasks._Framework.IWorld._IWorld [12:select env_5_0::iTasks._Framework.IWorld._IWorld 12])) (False -> let env_5_0 = select _x_3_0::_Tuple5 4 in _Tuple5 (Data.Error.Ok (iTasks._Framework.WebService.NTProcessingRequest request_1 (select _x_3_0::_Tuple5 2))) (select _x_3_0::_Tuple5 3) (select _x_3_0::_Tuple5 0) done_3_1 (update env_5_0::iTasks._Framework.IWorld._IWorld [12:select env_5_0::iTasks._Framework.IWorld._IWorld 12])) ) ) (Data.Maybe.Nothing -> _Tuple5 (Data.Error.Ok connState_6) Data.Maybe.Nothing (_predefined._Cons "HTTP/1.1 400 Bad Request\r\n\r\n" _predefined._Nil) True env_5) 
iTasks._Framework.WebService.onDisconnect_34 requestProcessHandlers_0 !connState_1 r_2 env_3 = case connState_1 (iTasks._Framework.WebService.NTProcessingRequest request_1_0 localState_1_1 -> <{iTasks._Framework.WebService._c;213;11_494}> (iTasks._Framework.WebService.selectHandler_35 request_1_0 requestProcessHandlers_0) connState_1 env_3 request_1_0 r_2 localState_1_1) (_ -> _Tuple3 (Data.Error.Ok connState_1) Data.Maybe.Nothing env_3)
<{iTasks._Framework.WebService._c;213;11_494}> !_x_0 connState_1 env_2 request_3 r_4 localState_5 = case _x_0 (Data.Maybe.Nothing -> _Tuple3 (Data.Error.Ok connState_1) Data.Maybe.Nothing env_2) (Data.Maybe.Just _x_1_0 -> case _x_1_0 (_Tuple5 _x_2_0 _x_2_1 _x_2_2 _x_2_3 connLostHandler_2_4 -> let _x_3_0 = connLostHandler_2_4 request_3 r_4 localState_5 env_2 in _Tuple3 (Data.Error.Ok connState_1) (select _x_3_0::_Tuple2 0) (select _x_3_0::_Tuple2 1)) ) 
iTasks._Framework.WebService.httpServer !_vTC_0 !_vTC_1 !port_2::I !keepAliveTime_3::I !requestProcessHandlers_4 sds_5 = iTasks._Framework.Task.wrapIWorldConnectionTask (_SystemDynamic.TypeCons (_SystemDynamic._TypeCodeConstructor <{iTasks._Framework.WebService.TD;NetTaskState}>)) _vTC_0 _vTC_1 (iTasks._Framework.Task._ConnectionHandlersIWorld iTasks._Framework.WebService.onConnect_32 (iTasks._Framework.WebService.whileConnected_33 keepAliveTime_3 port_2 requestProcessHandlers_4) (iTasks._Framework.WebService.onDisconnect_34 requestProcessHandlers_4)) sds_5
<{iTasks._Framework.WebService.c;247;41_38}> !g_l_0 = <{iTasks._Framework.WebService.g_c1;247;64_496}> g_l_0
<{iTasks._Framework.WebService.g_c1;247;64_496}> !g_l_0 = case g_l_0 (_predefined._Cons g_h_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.g_c2;247;64_495}> g_h_1_0 g_t_1_1) (_ -> _predefined._Nil)
<{iTasks._Framework.WebService.g_c2;247;64_495}> !g_h_0 g_t_1 = case g_h_0 (iTasks._Framework.Engine._PublishedTask url_1_0 task_1_1 -> _predefined._Cons url_1_0 (<{iTasks._Framework.WebService.c;247;41_38}> g_t_1)) (_ -> <{iTasks._Framework.WebService.c;247;41_38}> g_t_1)
iTasks._Framework.WebService.uiUrl_50 !matchUrl_0 = <{StdString.+++_11}> (<{iTasks._Framework.WebService._if;329;23_497}> (Text.endsWith_2 "/" matchUrl_0) matchUrl_0) "gui-wsock"
<{iTasks._Framework.WebService._if;329;23_497}> !_x_0::B !matchUrl_1 = case _x_0 (True -> matchUrl_1) (_ -> <{StdString.+++_11}> matchUrl_1 "/")
<{iTasks._Framework.WebService.c;250;62_39}> reqUrl_0 !g_l_1 = <{iTasks._Framework.WebService.g_c1;250;74_498}> g_l_1 reqUrl_0
<{iTasks._Framework.WebService.g_c1;250;74_498}> !g_l_0 reqUrl_1 = case g_l_0 (_predefined._Cons matchUrl_1_0 g_t_1_1 -> _predefined._Cons (<{StdString.==_2}> reqUrl_1 (iTasks._Framework.WebService.uiUrl_50 matchUrl_1_0)) (<{iTasks._Framework.WebService.c;250;62_39}> reqUrl_1 g_t_1_1)) (_ -> _predefined._Nil)
iTasks._Framework.WebService.matchFun_44::B !matchUrls_0 reqUrl_1 = StdList.or (<{iTasks._Framework.WebService.c;250;62_39}> reqUrl_1 matchUrls_0)
<{iTasks._Framework.WebService.get`_78}> !<{_v<_0}> _x_1 !_x_2 = case _x_2 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 _x_1 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_78}> <{_v<_0}> _x_1 l_1_3) (False -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 kx_1_1 _x_1) (True -> <{iTasks._Framework.WebService.get`_78}> <{_v<_0}> _x_1 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
<{iTasks._Framework.WebService.get`_77}> !<{_v<_0}> _x_1 !_x_2 = case _x_2 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 _x_1 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_77}> <{_v<_0}> _x_1 l_1_3) (False -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 kx_1_1 _x_1) (True -> <{iTasks._Framework.WebService.get`_77}> <{_v<_0}> _x_1 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
<{iTasks._Framework.WebService.get`_76}> !<{_v<_0}> _x_1 !_x_2 = case _x_2 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 _x_1 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_76}> <{_v<_0}> _x_1 l_1_3) (False -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 kx_1_1 _x_1) (True -> <{iTasks._Framework.WebService.get`_76}> <{_v<_0}> _x_1 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
iTasks._Framework.WebService.wsockHandShake key_0 = Text.Encodings.Base64.base64Encode (select (Crypto.Hash.SHA1.sha1StringDigest (<{StdString.+++_11}> key_0 "258EAFA5-E914-47DA-95CA-C5AB0DC85B11"))::_Tuple1 0)
<{iTasks._Framework.WebService.get`_458}> _x_0 !_x_1 = case _x_1 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (<{StdString.<_3}> _x_0 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_458}> _x_0 l_1_3) (False -> case (<{StdString.<_3}> kx_1_1 _x_0) (True -> <{iTasks._Framework.WebService.get`_458}> _x_0 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
<{iTasks._Framework.WebService.get`_457}> _x_0 !_x_1 = case _x_1 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (<{StdString.<_3}> _x_0 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_457}> _x_0 l_1_3) (False -> case (<{StdString.<_3}> kx_1_1 _x_0) (True -> <{iTasks._Framework.WebService.get`_457}> _x_0 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
<{iTasks._Framework.WebService.get`_456}> _x_0 !_x_1 = case _x_1 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (<{StdString.<_3}> _x_0 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_456}> _x_0 l_1_3) (False -> case (<{StdString.<_3}> kx_1_1 _x_0) (True -> <{iTasks._Framework.WebService.get`_456}> _x_0 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
iTasks._Framework.WebService.reqFun_46 taskUrls_0 !req_1 output_2 !iworld_3 = case iworld_3 (iTasks._Framework.IWorld._IWorld server_1_0 config_1_1 clocks_1_2 current_1_3 random_1_4 sdsNotifyRequests_1_5 memoryShares_1_6 cachedShares_1_7 exposedShares_1_8 jsCompilerState_1_9 ioTasks_1_10 ioStates_1_11 world_1_12 resources_1_13 onClient_1_14 shutdown_1_15 -> case server_1_0 (iTasks._Framework.IWorld._ServerInfo serverName_2_0 serverURL_2_1 build_2_2 paths_2_3 -> case (iTasks._Framework.WebService._f500_500 (<{iTasks._Framework.WebService._c;258;79_499}> (<{iTasks._Framework.WebService.get`_456}> "Upgrade" (select req_1::Internet.HTTP._HTTPRequest 5))) req_1) (True -> _Tuple4 (update (Internet.HTTP.newHTTPResponse 101 "Switching Protocols")::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Upgrade" "websocket") (_predefined._Cons (_Tuple2 "Connection" "Upgrade") (_predefined._Cons (_Tuple2 "Sec-WebSocket-Accept" (iTasks._Framework.WebService.wsockHandShake (Text.trim_18 (Data.Maybe.fromJust (<{iTasks._Framework.WebService.get`_458}> "Sec-WebSocket-Key" (select req_1::Internet.HTTP._HTTPRequest 5)))))) _predefined._Nil)),3:""]) (Data.Maybe.Just (_Tuple2 (iTasks._Framework.WebService._WebSockState "" True _predefined._Nil) _predefined._Nil)) Data.Maybe.Nothing iworld_3) (False -> _Tuple4 (Internet.HTTP.errorResponse "Requested service format not available for this task") Data.Maybe.Nothing Data.Maybe.Nothing iworld_3) ) ) 
iTasks._Framework.WebService._f500_500::B !_x_0::B req_1 = case _x_0 (True -> Data.Maybe.isJust (<{iTasks._Framework.WebService.get`_457}> "Sec-WebSocket-Key" (select req_1::Internet.HTTP._HTTPRequest 5))) (_ -> False)
<{iTasks._Framework.WebService._c;258;79_499}>::B !_x_0 = case _x_0 (Data.Maybe.Just _x_1_0 -> case _x_1_0 ("websocket" -> True) ) (_ -> False)
<{iTasks._Framework.WebService.reqFun`_45}> taskUrls_0 !req_1 output_2 !iworld_3 = case iworld_3 (iTasks._Framework.IWorld._IWorld server_1_0 config_1_1 clocks_1_2 current_1_3 random_1_4 sdsNotifyRequests_1_5 memoryShares_1_6 cachedShares_1_7 exposedShares_1_8 jsCompilerState_1_9 ioTasks_1_10 ioStates_1_11 world_1_12 resources_1_13 onClient_1_14 shutdown_1_15 -> iTasks._Framework.WebService.reqFun_46 taskUrls_0 req_1 output_2 (update iworld_3::iTasks._Framework.IWorld._IWorld [0:update server_1_0::iTasks._Framework.IWorld._ServerInfo [1:<{StdString.+++_11}> "//" (<{StdString.+++_11}> (select req_1::Internet.HTTP._HTTPRequest 11) (<{StdString.+++_11}> ":" (StdString.toString_5 (select req_1::Internet.HTTP._HTTPRequest 12))))]])) 
iTasks._Framework.WebService.foldr_75 op_0 r_1 !_x_2 = case _x_2 (_predefined._Nil -> r_1) (_predefined._Cons a_1_0 x_1_1 -> op_0 a_1_0 (iTasks._Framework.WebService.foldr_75 op_0 r_1 x_1_1)) 
<{iTasks._Framework.WebService.c;101;73_18}> !_vArray_0 data_1 !b_2::I !g_s_3::I i_4::I g_s_5::I = case (StdBool.not (<{StdInt.<_17}> g_s_3 b_2)) (True -> case (StdBool.not (<{StdInt.<_17}> g_s_5 i_4)) (True -> _predefined._Cons (<{StdInt.<<}> (StdChar.fromChar_22 (select _vArray_0::<{_SystemArray.Array;}> 3 data_1 b_2)) (<{StdInt.*_9}> i_4 8)) (<{iTasks._Framework.WebService.c;101;73_18}> _vArray_0 data_1 (<{StdInt.+_6}> b_2 StdInt.one_11) g_s_3 (<{StdInt.+_6}> i_4 StdInt.one_11) g_s_5)) (False -> _predefined._Nil) ) (False -> _predefined._Nil) 
iTasks._Framework.WebService.foldr_459::I !r_0::I !_x_1 = case _x_1 (_predefined._Nil -> r_0) (_predefined._Cons a_1_0 x_1_1 -> <{StdInt.+_6}> a_1_0 (iTasks._Framework.WebService.foldr_459 r_0 x_1_1)) 
iTasks._Framework.WebService.payloadLen_21 !_vArray_0 data_1 = let len_1_0::I = StdInt.bitand (StdChar.fromChar_22 (select _vArray_0::<{_SystemArray.Array;}> 3 data_1 1)) 127 in case (<{StdInt.==_16}> len_1_0 126) (True -> _Tuple2 (<{StdInt.+_6}> (<{StdInt.<<}> (StdChar.fromChar_22 (select _vArray_0::<{_SystemArray.Array;}> 3 data_1 2)) 8) (StdChar.fromChar_22 (select _vArray_0::<{_SystemArray.Array;}> 3 data_1 3))) 2) (False -> case (<{StdInt.==_16}> len_1_0 127) (True -> _Tuple2 (iTasks._Framework.WebService.foldr_459 0 (<{iTasks._Framework.WebService.c;101;73_18}> _vArray_0 data_1 2 9 0 7)) 8) (False -> _Tuple2 len_1_0 0) ) 
iTasks._Framework.WebService.decode_20::C !_vArray_0 mask_1 i_2::I !c_3::C = StdChar.toChar_21 (StdInt.bitxor (StdChar.fromChar_22 (select _vArray_0::<{_SystemArray.Array;}> 3 mask_1 (StdInt.rem_28 i_2 4))) (StdChar.fromChar_22 c_3))
<{iTasks._Framework.WebService.cu;104;64_19}> !_vArray_0 !_vArray_1 !_vArray_2 mask_3 c_a_4 !c_i_5::I !g_s_6::I g_a_7 = case (StdBool.not (<{StdInt.<_17}> g_s_6 c_i_5)) (True -> let !g_a_2_0 = _predefined._dummyForStrictAlias (select _x_2_1::_Tuple2 1), _x_2_1 = select _vArray_0::<{_SystemArray.Array;}> 6 g_a_7 c_i_5 in <{iTasks._Framework.WebService.cu;104;64_19}> _vArray_0 _vArray_1 _vArray_2 mask_3 (select _vArray_2::<{_SystemArray.Array;}> 5 c_a_4 c_i_5 (iTasks._Framework.WebService.decode_20 _vArray_1 mask_3 c_i_5 (select _x_2_1::_Tuple2 0))) (<{StdInt.+_6}> c_i_5 StdInt.one_11) g_s_6 g_a_2_0) (False -> c_a_4) 
iTasks._Framework.WebService.decodePayload_22 !_vArray_0 !_vArray_1 !_vArray_2 mask_3 encoded_4 = let _x_1_0::I = select _vArray_0::<{_SystemArray.Array;}> 7 encoded_4, g_s2_1_1 = <{StdInt.-_7}> (select _x_1_0::_Tuple2 0) 1 in <{iTasks._Framework.WebService.cu;104;64_19}> _vArray_0 _vArray_2 _vArray_1 mask_3 (select _vArray_1::<{_SystemArray.Array;}> 0 (<{StdInt.+_6}> g_s2_1_1 StdInt.one_11)) 0 g_s2_1_1 (select _x_1_0::_Tuple2 1)
<{iTasks._Framework.WebService.c;101;73_461}> data_0 !b_1::I !g_s_2::I i_3::I g_s_4::I = case (StdBool.not (<{StdInt.<_17}> g_s_2 b_1)) (True -> case (StdBool.not (<{StdInt.<_17}> g_s_4 i_3)) (True -> _predefined._Cons (<{StdInt.<<}> (StdChar.fromChar_22 (_SystemArray.select_19 data_0 b_1)) (<{StdInt.*_9}> i_3 8)) (<{iTasks._Framework.WebService.c;101;73_461}> data_0 (<{StdInt.+_6}> b_1 StdInt.one_11) g_s_2 (<{StdInt.+_6}> i_3 StdInt.one_11) g_s_4)) (False -> _predefined._Nil) ) (False -> _predefined._Nil) 
iTasks._Framework.WebService.payloadLen_460 !data_0 = let len_1_0::I = StdInt.bitand (StdChar.fromChar_22 (_SystemArray.select_19 data_0 1)) 127 in case (<{StdInt.==_16}> len_1_0 126) (True -> _Tuple2 (<{StdInt.+_6}> (<{StdInt.<<}> (StdChar.fromChar_22 (_SystemArray.select_19 data_0 2)) 8) (StdChar.fromChar_22 (_SystemArray.select_19 data_0 3))) 2) (False -> case (<{StdInt.==_16}> len_1_0 127) (True -> _Tuple2 (iTasks._Framework.WebService.foldr_459 0 (<{iTasks._Framework.WebService.c;101;73_461}> data_0 2 9 0 7)) 8) (False -> _Tuple2 len_1_0 0) ) 
<{iTasks._Framework.WebService.cu;104;64_463}> !_vArray_0 !_vArray_1 mask_2 c_a_3 !c_i_4::I !g_s_5::I g_a_6 = case (StdBool.not (<{StdInt.<_17}> g_s_5 c_i_4)) (True -> let !g_a_2_0 = _predefined._dummyForStrictAlias (select _x_2_1::_Tuple2 1), _x_2_1 = _SystemArray.uselect_22 g_a_6 c_i_4 in <{iTasks._Framework.WebService.cu;104;64_463}> _vArray_0 _vArray_1 mask_2 (select _vArray_1::<{_SystemArray.Array;}> 5 c_a_3 c_i_4 (iTasks._Framework.WebService.decode_20 _vArray_0 mask_2 c_i_4 (select _x_2_1::_Tuple2 0))) (<{StdInt.+_6}> c_i_4 StdInt.one_11) g_s_5 g_a_2_0) (False -> c_a_3) 
iTasks._Framework.WebService.decodePayload_462 !_vArray_0 !_vArray_1 mask_2 !encoded_3 = let _x_1_0::I = _SystemArray.usize_23 encoded_3, g_s2_1_1 = <{StdInt.-_7}> (select _x_1_0::_Tuple2 0) 1 in <{iTasks._Framework.WebService.cu;104;64_463}> _vArray_1 _vArray_0 mask_2 (select _vArray_0::<{_SystemArray.Array;}> 0 (<{StdInt.+_6}> g_s2_1_1 StdInt.one_11)) 0 g_s2_1_1 (select _x_1_0::_Tuple2 1)
<{iTasks._Framework.WebService.cu;104;64_465}> !_vArray_0 mask_1 !c_a_2 !c_i_3::I !g_s_4::I g_a_5 = case (StdBool.not (<{StdInt.<_17}> g_s_4 c_i_3)) (True -> let !g_a_2_0 = _predefined._dummyForStrictAlias (select _x_2_1::_Tuple2 1), _x_2_1 = _SystemArray.uselect_22 g_a_5 c_i_3 in <{iTasks._Framework.WebService.cu;104;64_465}> _vArray_0 mask_1 (_SystemArray.update_21 c_a_2 c_i_3 (iTasks._Framework.WebService.decode_20 _vArray_0 mask_1 c_i_3 (select _x_2_1::_Tuple2 0))) (<{StdInt.+_6}> c_i_3 StdInt.one_11) g_s_4 g_a_2_0) (False -> c_a_2) 
iTasks._Framework.WebService.decodePayload_464 !_vArray_0 mask_1 !encoded_2 = let _x_1_0::I = _SystemArray.usize_23 encoded_2, g_s2_1_1 = <{StdInt.-_7}> (select _x_1_0::_Tuple2 0) 1 in <{iTasks._Framework.WebService.cu;104;64_465}> _vArray_0 mask_1 (_SystemArray._createArray_16 (<{StdInt.+_6}> g_s2_1_1 StdInt.one_11)) 0 g_s2_1_1 (select _x_1_0::_Tuple2 1)
iTasks._Framework.WebService.decode_468::C !mask_0 !i_1::I !c_2::C = StdChar.toChar_21 (StdInt.bitxor (StdChar.fromChar_22 (_SystemArray.select_19 mask_0 (StdInt.rem_28 i_1 4))) (StdChar.fromChar_22 c_2))
<{iTasks._Framework.WebService.cu;104;64_467}> mask_0 !c_a_1 !c_i_2::I !g_s_3::I g_a_4 = case (StdBool.not (<{StdInt.<_17}> g_s_3 c_i_2)) (True -> let !g_a_2_0 = _predefined._dummyForStrictAlias (select _x_2_1::_Tuple2 1), _x_2_1 = _SystemArray.uselect_22 g_a_4 c_i_2 in <{iTasks._Framework.WebService.cu;104;64_467}> mask_0 (_SystemArray.update_21 c_a_1 c_i_2 (iTasks._Framework.WebService.decode_468 mask_0 c_i_2 (select _x_2_1::_Tuple2 0))) (<{StdInt.+_6}> c_i_2 StdInt.one_11) g_s_3 g_a_2_0) (False -> c_a_1) 
iTasks._Framework.WebService.decodePayload_466 mask_0 !encoded_1 = let _x_1_0::I = _SystemArray.usize_23 encoded_1, g_s2_1_1 = <{StdInt.-_7}> (select _x_1_0::_Tuple2 0) 1 in <{iTasks._Framework.WebService.cu;104;64_467}> mask_0 (_SystemArray._createArray_16 (<{StdInt.+_6}> g_s2_1_1 StdInt.one_11)) 0 g_s2_1_1 (select _x_1_0::_Tuple2 1)
iTasks._Framework.WebService.wsockReadFrame !state_0 !data_1 = case state_0 (iTasks._Framework.WebService._WebSockState cur_frame_1_0 message_text_1_1 message_data_1_2 -> let cur_frame_2_0 = <{StdString.+++_11}> cur_frame_1_0 data_1 in case (<{StdInt.<_17}> (_SystemArray.size_20 cur_frame_2_0) 6) (True -> _Tuple2 (update state_0::iTasks._Framework.WebService._WebSockState [0:cur_frame_2_0]) _predefined._Nil) (False -> let _x_4_0::I = iTasks._Framework.WebService.payloadLen_460 cur_frame_2_0, ext_payload_length_size_4_1::I = select _x_4_0::_Tuple2 1, masked_4_2::B = <{StdInt.<_17}> 0 (StdInt.bitand (StdChar.fromChar_22 (_SystemArray.select_19 cur_frame_2_0 1)) 128), payload_length_4_3::I = select _x_4_0::_Tuple2 0, frame_length_4_4 = <{StdInt.+_6}> (<{StdInt.+_6}> (<{StdInt.+_6}> 2 ext_payload_length_size_4_1) (<{iTasks._Framework.WebService._if;65;52_501}> masked_4_2)) payload_length_4_3 in case (<{StdInt.<_17}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) (True -> _Tuple2 (update state_0::iTasks._Framework.WebService._WebSockState [0:cur_frame_2_0]) _predefined._Nil) (False -> let opcode_6_0::I = StdInt.bitand (StdChar.fromChar_22 (_SystemArray.select_19 cur_frame_2_0 0)) 15 in case (<{StdInt.==_16}> opcode_6_0 8) (True -> _Tuple2 (<{iTasks._Framework.WebService._if;76;15_502}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4) (_predefined._Cons (iTasks._Framework.WebService.WSClose (<{iTasks._Framework.WebService._if;70;17_503}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3)) _predefined._Nil)) (False -> case (<{StdInt.==_16}> opcode_6_0 9) (True -> _Tuple2 (<{iTasks._Framework.WebService._if;76;15_504}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4) (_predefined._Cons (iTasks._Framework.WebService.WSPing (<{iTasks._Framework.WebService._if;70;17_505}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3)) _predefined._Nil)) (False -> case (<{StdInt.==_16}> opcode_6_0 1) (True -> case (<{StdInt.<_17}> 0 (StdInt.bitand (StdChar.fromChar_22 (_SystemArray.select_19 cur_frame_2_0 0)) 128)) (True -> _Tuple2 (update (<{iTasks._Framework.WebService._if;76;15_506}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4)::iTasks._Framework.WebService._WebSockState [2:_predefined._Nil]) (_predefined._Cons (iTasks._Framework.WebService.WSTextMessage (<{iTasks._Framework.WebService._if;70;17_507}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3)) _predefined._Nil)) (False -> _Tuple2 (update (<{iTasks._Framework.WebService._if;76;15_508}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4)::iTasks._Framework.WebService._WebSockState [1:True,2:_predefined._Cons (<{iTasks._Framework.WebService._if;70;17_509}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3) _predefined._Nil]) _predefined._Nil) ) (False -> case (<{StdInt.==_16}> opcode_6_0 2) (True -> case (<{StdInt.<_17}> 0 (StdInt.bitand (StdChar.fromChar_22 (_SystemArray.select_19 cur_frame_2_0 0)) 128)) (True -> _Tuple2 (update (<{iTasks._Framework.WebService._if;76;15_510}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4)::iTasks._Framework.WebService._WebSockState [2:_predefined._Nil]) (_predefined._Cons (iTasks._Framework.WebService.WSBinMessage (<{iTasks._Framework.WebService._if;70;17_511}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3)) _predefined._Nil)) (False -> _Tuple2 (update (<{iTasks._Framework.WebService._if;76;15_512}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4)::iTasks._Framework.WebService._WebSockState [1:False,2:_predefined._Cons (<{iTasks._Framework.WebService._if;70;17_513}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3) _predefined._Nil]) _predefined._Nil) ) (False -> case (<{StdInt.==_16}> opcode_6_0 0) (True -> case (<{StdInt.<_17}> 0 (StdInt.bitand (StdChar.fromChar_22 (_SystemArray.select_19 cur_frame_2_0 0)) 128)) (True -> let state_13_0 = <{iTasks._Framework.WebService._if;76;15_514}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4 in _Tuple2 (update state_13_0::iTasks._Framework.WebService._WebSockState [2:_predefined._Nil]) (_predefined._Cons (<{iTasks._Framework.WebService._if;91;50_515}> (select state_13_0::iTasks._Framework.WebService._WebSockState 1) (Text.concat_0 (StdList.reverse (_predefined._Cons (<{iTasks._Framework.WebService._if;70;17_516}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3) (select state_13_0::iTasks._Framework.WebService._WebSockState 2))))) _predefined._Nil)) (False -> let state_13_0 = <{iTasks._Framework.WebService._if;76;15_517}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4 in _Tuple2 (update state_13_0::iTasks._Framework.WebService._WebSockState [2:_predefined._Cons (<{iTasks._Framework.WebService._if;70;17_518}> masked_4_2 cur_frame_2_0 ext_payload_length_size_4_1 payload_length_4_3) (select state_13_0::iTasks._Framework.WebService._WebSockState 2)]) _predefined._Nil) ) (False -> _Tuple2 (<{iTasks._Framework.WebService._if;76;15_519}> (<{StdInt.==_16}> (_SystemArray.size_20 cur_frame_2_0) frame_length_4_4) state_0 cur_frame_2_0 frame_length_4_4) _predefined._Nil) ) ) ) ) ) ) ) 
<{iTasks._Framework.WebService._if;76;15_519}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_518}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;76;15_517}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_516}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;91;50_515}> !_x_0::B = case _x_0 (True -> iTasks._Framework.WebService.WSTextMessage) (_ -> iTasks._Framework.WebService.WSBinMessage)
<{iTasks._Framework.WebService._if;76;15_514}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_513}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;76;15_512}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_511}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;76;15_510}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_509}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;76;15_508}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_507}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;76;15_506}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_505}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;76;15_504}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;70;17_503}> !masked_0::B !cur_frame_1 !ext_payload_length_size_2::I !payload_length_3::I = case masked_0 (True -> iTasks._Framework.WebService.decodePayload_466 (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) (<{StdInt.+_6}> 5 ext_payload_length_size_2))) (<{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 6 ext_payload_length_size_2) (<{StdInt.-_7}> (<{StdInt.+_6}> (<{StdInt.+_6}> 6 ext_payload_length_size_2) payload_length_3) 1)))) (_ -> <{StdString.%_10}> cur_frame_1 (_Tuple2 (<{StdInt.+_6}> 2 ext_payload_length_size_2) payload_length_3))
<{iTasks._Framework.WebService._if;76;15_502}> !_x_0::B !state_1 cur_frame_2 frame_length_3::I = case _x_0 (True -> update state_1::iTasks._Framework.WebService._WebSockState [0:""]) (_ -> update state_1::iTasks._Framework.WebService._WebSockState [0:<{StdString.%_10}> cur_frame_2 (_Tuple2 frame_length_3 (_SystemArray.size_20 cur_frame_2))])
<{iTasks._Framework.WebService._if;65;52_501}>::I !masked_0::B = case masked_0 (True -> 4) (_ -> 0)
iTasks._Framework.WebService.wsockAddData !state_0 !data_1 = let _x_1_0 = iTasks._Framework.WebService.wsockReadFrame state_0 data_1, evCur_1_1 = select _x_1_0::_Tuple2 1 in case (<{iTasks._Framework.WebService._c;52;16_520}> evCur_1_1) (True -> <{_Tuple2!3}> (select _x_1_0::_Tuple2 0) _predefined._Nil) (False -> let _x_3_0 = iTasks._Framework.WebService.wsockAddData (select _x_1_0::_Tuple2 0) "" in <{_Tuple2!3}> (select _x_3_0::_Tuple2 0) (<{StdList.++}> evCur_1_1 (select _x_3_0::_Tuple2 1))) 
<{iTasks._Framework.WebService._c;52;16_520}>::B !_x_0 = case _x_0 (_predefined._Nil -> True) (_ -> False)
iTasks._Framework.WebService.frame_29 !_vArray_0 !_vtoChar_1 !<{_v+++_2}> opcode_3::I final_4::B payload_length_5 ext_payload_length_6 payload_7 = select <{_v+++_2}>::<{StdOverloaded.+++;}> 0 (select _vArray_0::<{_SystemArray.Array;}> 5 (select _vArray_0::<{_SystemArray.Array;}> 5 (select _vArray_0::<{_SystemArray.Array;}> 0 2) 1 (select _vtoChar_1::<{StdOverloaded.toChar;}> 0 payload_length_5)) 0 (StdChar.toChar_21 (StdInt.bitor opcode_3 (<{iTasks._Framework.WebService._if;127;34_521}> final_4)))) (select <{_v+++_2}>::<{StdOverloaded.+++;}> 0 ext_payload_length_6 payload_7)
<{iTasks._Framework.WebService._if;127;34_521}>::I !final_0::B = case final_0 (True -> 128) (_ -> 0)
<{iTasks._Framework.WebService.cu;120;66_24}> !_vone_0 !<{_v+_1}> c_l_i_2 !g_l_3 = <{iTasks._Framework.WebService.g_c1;120;71_522}> g_l_3 _vone_0 <{_v+_1}> c_l_i_2
<{iTasks._Framework.WebService.g_c1;120;71_522}> !g_l_0 _vone_1 <{_v+_2}> c_l_i_3 = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;120;66_24}> _vone_1 <{_v+_2}> (select <{_v+_2}>::<{StdOverloaded.+;}> 0 c_l_i_3 (select _vone_1::<{StdOverloaded.one;}> 0)) g_t_1_1) (_ -> c_l_i_3)
<{iTasks._Framework.WebService.cu;120;66_23}> !_vArray_0 num_bytes_1::I c_a_2 c_i_3::I !g_l_4 = <{iTasks._Framework.WebService.g_c1;120;71_523}> g_l_4 _vArray_0 num_bytes_1 c_a_2 c_i_3
<{iTasks._Framework.WebService.g_c1;120;71_523}> !g_l_0 _vArray_1 num_bytes_2::I c_a_3 c_i_4::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;120;66_23}> _vArray_1 num_bytes_2 (select _vArray_1::<{_SystemArray.Array;}> 5 c_a_3 c_i_4 (StdChar.toChar_21 (<{StdInt.>>}> num_bytes_2 (<{StdInt.*_9}> 8 i_1_0)))) (<{StdInt.+_6}> c_i_4 StdInt.one_11) g_t_1_1) (_ -> c_a_3)
<{iTasks._Framework.WebService.cu;123;84_28}> !_vone_0 !<{_v+_1}> c_l_i_2 !g_l_3 = <{iTasks._Framework.WebService.g_c1;123;89_524}> g_l_3 _vone_0 <{_v+_1}> c_l_i_2
<{iTasks._Framework.WebService.g_c1;123;89_524}> !g_l_0 _vone_1 <{_v+_2}> c_l_i_3 = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;123;84_28}> _vone_1 <{_v+_2}> (select <{_v+_2}>::<{StdOverloaded.+;}> 0 c_l_i_3 (select _vone_1::<{StdOverloaded.one;}> 0)) g_t_1_1) (_ -> c_l_i_3)
<{iTasks._Framework.WebService.cu;123;84_27}> !_vArray_0 num_bytes_1::I c_a_2 c_i_3::I !g_l_4 = <{iTasks._Framework.WebService.g_c1;123;89_526}> g_l_4 _vArray_0 num_bytes_1 c_a_2 c_i_3
<{iTasks._Framework.WebService.g_c1;123;89_526}> !g_l_0 _vArray_1 num_bytes_2::I c_a_3 c_i_4::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;123;84_27}> _vArray_1 num_bytes_2 (select _vArray_1::<{_SystemArray.Array;}> 5 c_a_3 c_i_4 (StdChar.toChar_21 (<{iTasks._Framework.WebService._if;123;49_525}> (<{StdInt.<_17}> i_1_0 4) num_bytes_2 i_1_0))) (<{StdInt.+_6}> c_i_4 StdInt.one_11) g_t_1_1) (_ -> c_a_3)
<{iTasks._Framework.WebService._if;123;49_525}>::I !_x_0::B num_bytes_1::I i_2::I = case _x_0 (True -> <{StdInt.>>}> num_bytes_1 (<{StdInt.*_9}> 8 i_2)) (_ -> 0)
<{iTasks._Framework.WebService.cu;122;69_26}> !_vone_0 !<{_v+_1}> c_l_i_2 !g_l_3 = <{iTasks._Framework.WebService.g_c1;122;74_527}> g_l_3 _vone_0 <{_v+_1}> c_l_i_2
<{iTasks._Framework.WebService.g_c1;122;74_527}> !g_l_0 _vone_1 <{_v+_2}> c_l_i_3 = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;122;69_26}> _vone_1 <{_v+_2}> (select <{_v+_2}>::<{StdOverloaded.+;}> 0 c_l_i_3 (select _vone_1::<{StdOverloaded.one;}> 0)) g_t_1_1) (_ -> c_l_i_3)
<{iTasks._Framework.WebService.cu;122;69_25}> !_vArray_0 num_bytes_1::I c_a_2 c_i_3::I !g_l_4 = <{iTasks._Framework.WebService.g_c1;122;74_528}> g_l_4 _vArray_0 num_bytes_1 c_a_2 c_i_3
<{iTasks._Framework.WebService.g_c1;122;74_528}> !g_l_0 _vArray_1 num_bytes_2::I c_a_3 c_i_4::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;122;69_25}> _vArray_1 num_bytes_2 (select _vArray_1::<{_SystemArray.Array;}> 5 c_a_3 c_i_4 (StdChar.toChar_21 (<{StdInt.>>}> num_bytes_2 (<{StdInt.*_9}> 8 i_1_0)))) (<{StdInt.+_6}> c_i_4 StdInt.one_11) g_t_1_1) (_ -> c_a_3)
iTasks._Framework.WebService.frame_469 !_vtoChar_0 !<{_v+++_1}> opcode_2::I final_3::B payload_length_4 ext_payload_length_5 payload_6 = select <{_v+++_1}>::<{StdOverloaded.+++;}> 0 (_SystemArray.update_21 (_SystemArray.update_21 (_SystemArray._createArray_16 2) 1 (select _vtoChar_0::<{StdOverloaded.toChar;}> 0 payload_length_4)) 0 (StdChar.toChar_21 (StdInt.bitor opcode_2 (<{iTasks._Framework.WebService._if;127;34_529}> final_3)))) (select <{_v+++_1}>::<{StdOverloaded.+++;}> 0 ext_payload_length_5 payload_6)
<{iTasks._Framework.WebService._if;127;34_529}>::I !final_0::B = case final_0 (True -> 128) (_ -> 0)
<{iTasks._Framework.WebService.cu;120;66_470}>::I !<{_v+_0}> c_l_i_1::I !g_l_2 = <{iTasks._Framework.WebService.g_c1;120;71_530}> g_l_2 <{_v+_0}> c_l_i_1
<{iTasks._Framework.WebService.g_c1;120;71_530}>::I !g_l_0 <{_v+_1}> c_l_i_2::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;120;66_470}> <{_v+_1}> (select <{_v+_1}>::<{StdOverloaded.+;}> 0 c_l_i_2 StdInt.one_11) g_t_1_1) (_ -> c_l_i_2)
<{iTasks._Framework.WebService.cu;120;66_471}> num_bytes_0::I !c_a_1 c_i_2::I !g_l_3 = <{iTasks._Framework.WebService.g_c1;120;71_531}> g_l_3 num_bytes_0 c_a_1 c_i_2
<{iTasks._Framework.WebService.g_c1;120;71_531}> !g_l_0 num_bytes_1::I !c_a_2 c_i_3::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;120;66_471}> num_bytes_1 (_SystemArray.update_21 c_a_2 c_i_3 (StdChar.toChar_21 (<{StdInt.>>}> num_bytes_1 (<{StdInt.*_9}> 8 i_1_0)))) (<{StdInt.+_6}> c_i_3 StdInt.one_11) g_t_1_1) (_ -> c_a_2)
<{iTasks._Framework.WebService.cu;123;84_472}>::I !<{_v+_0}> c_l_i_1::I !g_l_2 = <{iTasks._Framework.WebService.g_c1;123;89_532}> g_l_2 <{_v+_0}> c_l_i_1
<{iTasks._Framework.WebService.g_c1;123;89_532}>::I !g_l_0 <{_v+_1}> c_l_i_2::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;123;84_472}> <{_v+_1}> (select <{_v+_1}>::<{StdOverloaded.+;}> 0 c_l_i_2 StdInt.one_11) g_t_1_1) (_ -> c_l_i_2)
<{iTasks._Framework.WebService.cu;123;84_473}> num_bytes_0::I !c_a_1 c_i_2::I !g_l_3 = <{iTasks._Framework.WebService.g_c1;123;89_534}> g_l_3 num_bytes_0 c_a_1 c_i_2
<{iTasks._Framework.WebService.g_c1;123;89_534}> !g_l_0 num_bytes_1::I !c_a_2 c_i_3::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;123;84_473}> num_bytes_1 (_SystemArray.update_21 c_a_2 c_i_3 (StdChar.toChar_21 (<{iTasks._Framework.WebService._if;123;49_533}> (<{StdInt.<_17}> i_1_0 4) num_bytes_1 i_1_0))) (<{StdInt.+_6}> c_i_3 StdInt.one_11) g_t_1_1) (_ -> c_a_2)
<{iTasks._Framework.WebService._if;123;49_533}>::I !_x_0::B num_bytes_1::I i_2::I = case _x_0 (True -> <{StdInt.>>}> num_bytes_1 (<{StdInt.*_9}> 8 i_2)) (_ -> 0)
iTasks._Framework.WebService.frame_474 !<{_v+++_0}> opcode_1::I final_2::B payload_length_3::I ext_payload_length_4 payload_5 = select <{_v+++_0}>::<{StdOverloaded.+++;}> 0 (_SystemArray.update_21 (_SystemArray.update_21 (_SystemArray._createArray_16 2) 1 (StdChar.toChar_21 payload_length_3)) 0 (StdChar.toChar_21 (StdInt.bitor opcode_1 (<{iTasks._Framework.WebService._if;127;34_535}> final_2)))) (select <{_v+++_0}>::<{StdOverloaded.+++;}> 0 ext_payload_length_4 payload_5)
<{iTasks._Framework.WebService._if;127;34_535}>::I !final_0::B = case final_0 (True -> 128) (_ -> 0)
<{iTasks._Framework.WebService.cu;120;66_475}>::I !c_l_i_0::I !g_l_1 = <{iTasks._Framework.WebService.g_c1;120;71_536}> g_l_1 c_l_i_0
<{iTasks._Framework.WebService.g_c1;120;71_536}>::I !g_l_0 !c_l_i_1::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;120;66_475}> (<{StdInt.+_6}> c_l_i_1 StdInt.one_11) g_t_1_1) (_ -> c_l_i_1)
<{iTasks._Framework.WebService.cu;123;84_476}>::I !c_l_i_0::I !g_l_1 = <{iTasks._Framework.WebService.g_c1;123;89_537}> g_l_1 c_l_i_0
<{iTasks._Framework.WebService.g_c1;123;89_537}>::I !g_l_0 !c_l_i_1::I = case g_l_0 (_predefined._Cons i_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.cu;123;84_476}> (<{StdInt.+_6}> c_l_i_1 StdInt.one_11) g_t_1_1) (_ -> c_l_i_1)
iTasks._Framework.WebService.frame_477 !opcode_0::I !final_1::B !payload_length_2::I !ext_payload_length_3 !payload_4 = <{StdString.+++_11}> (_SystemArray.update_21 (_SystemArray.update_21 (_SystemArray._createArray_16 2) 1 (StdChar.toChar_21 payload_length_2)) 0 (StdChar.toChar_21 (StdInt.bitor opcode_0 (<{iTasks._Framework.WebService._if;127;34_538}> final_1)))) (<{StdString.+++_11}> ext_payload_length_3 payload_4)
<{iTasks._Framework.WebService._if;127;34_538}>::I !final_0::B = case final_0 (True -> 128) (_ -> 0)
iTasks._Framework.WebService.wsockMsgFrame !opcode_0::I !final_1::B !payload_2 = let num_bytes_1_0::I = _SystemArray.size_20 payload_2 in case (<{StdInt.<_17}> num_bytes_1_0 125) (True -> iTasks._Framework.WebService.frame_477 opcode_0 final_1 num_bytes_1_0 "" payload_2) (False -> case (<{StdInt.<_17}> num_bytes_1_0 65536) (True -> iTasks._Framework.WebService.frame_477 opcode_0 final_1 126 (<{iTasks._Framework.WebService.cu;120;66_471}> num_bytes_1_0 (_SystemArray._createArray_16 (<{iTasks._Framework.WebService.cu;120;66_475}> 0 (_predefined._Cons 1 (_predefined._Cons 0 _predefined._Nil)))) 0 (_predefined._Cons 1 (_predefined._Cons 0 _predefined._Nil))) payload_2) (False -> iTasks._Framework.WebService.frame_477 opcode_0 final_1 127 (<{iTasks._Framework.WebService.cu;123;84_473}> num_bytes_1_0 (_SystemArray._createArray_16 (<{iTasks._Framework.WebService.cu;123;84_476}> 0 (_predefined._Cons 7 (_predefined._Cons 6 (_predefined._Cons 5 (_predefined._Cons 4 (_predefined._Cons 3 (_predefined._Cons 2 (_predefined._Cons 1 (_predefined._Cons 0 _predefined._Nil)))))))))) 0 (_predefined._Cons 7 (_predefined._Cons 6 (_predefined._Cons 5 (_predefined._Cons 4 (_predefined._Cons 3 (_predefined._Cons 2 (_predefined._Cons 1 (_predefined._Cons 0 _predefined._Nil))))))))) payload_2) ) 
iTasks._Framework.WebService.wsockControlFrame !opcode_0::I !payload_1 = iTasks._Framework.WebService.wsockMsgFrame opcode_0 True payload_1
iTasks._Framework.WebService.wsockPongMsg !payload_0 = iTasks._Framework.WebService.wsockControlFrame 10 payload_0
iTasks._Framework.WebService.wsockTextMsg payload_0 = _predefined._Cons (iTasks._Framework.WebService.wsockMsgFrame 1 True payload_0) _predefined._Nil
<{iTasks._Framework.WebService.createTaskInstance`_49}> !req_0 !_x_1 !iworld_2 = case _x_1 (_predefined._Cons _x_1_0 taskUrls_1_1 -> case _x_1_0 (iTasks._Framework.Engine._PublishedTask url_2_0 _x_2_1 -> case _x_2_1 (iTasks._Framework.Engine.TaskWrapper _viTask_3_0 task_3_1 -> case (<{StdString.==_2}> (select req_0::Internet.HTTP._HTTPRequest 1) (iTasks._Framework.WebService.uiUrl_50 url_2_0)) (True -> iTasks._Framework.TaskStore.createTaskInstance _viTask_3_0 (task_3_1 req_0) iworld_2) (False -> <{iTasks._Framework.WebService.createTaskInstance`_49}> req_0 taskUrls_1_1 iworld_2) ) ) ) 
iTasks._Framework.WebService.wsockCloseMsg !payload_0 = iTasks._Framework.WebService.wsockControlFrame 8 payload_0
<{iTasks._Framework.WebService.get`_74}> !<{_v<_0}> _x_1 !_x_2 = case _x_2 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 _x_1 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_74}> <{_v<_0}> _x_1 l_1_3) (False -> case (select <{_v<_0}>::<{StdOverloaded.<;}> 0 kx_1_1 _x_1) (True -> <{iTasks._Framework.WebService.get`_74}> <{_v<_0}> _x_1 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
iTasks._Framework.WebService.toList_42 q_0 = <{iTasks._Framework.WebService._c;339;20_539}> (Data.Queue.dequeue q_0)
<{iTasks._Framework.WebService._c;339;20_539}> !_x_0 = case _x_0 (_Tuple2 _x_1_0 q_1_1 -> case _x_1_0 (Data.Maybe.Nothing -> _predefined._Nil) (Data.Maybe.Just x_2_0 -> _predefined._Cons x_2_0 (iTasks._Framework.WebService.toList_42 q_1_1)) ) 
<{iTasks._Framework.WebService.c;336;35_41}> i_0 !g_l_1 = <{iTasks._Framework.WebService.g_c1;336;40_540}> g_l_1 i_0
<{iTasks._Framework.WebService.g_c1;336;40_540}> !g_l_0 i_1 = case g_l_0 (_predefined._Cons c_1_0 g_t_1_1 -> _predefined._Cons (_Tuple2 i_1 c_1_0) (<{iTasks._Framework.WebService.c;336;35_41}> i_1 g_t_1_1)) (_ -> _predefined._Nil)
<{iTasks._Framework.WebService.get`_478}> _x_0::I !_x_1 = case _x_1 (Data.Map.Tip -> Data.Maybe.Nothing) (Data.Map.Bin _x_1_0 kx_1_1 x_1_2 l_1_3 r_1_4 -> case (<{StdInt.<_17}> _x_0 kx_1_1) (True -> <{iTasks._Framework.WebService.get`_478}> _x_0 l_1_3) (False -> case (<{StdInt.<_17}> kx_1_1 _x_0) (True -> <{iTasks._Framework.WebService.get`_478}> _x_0 r_1_4) (False -> Data.Maybe.Just x_1_2) ) ) 
iTasks._Framework.WebService.dequeueOutput_51 !_x_0 !states_1 = case _x_0 (_predefined._Nil -> <{_Tuple2!3}> _predefined._Nil states_1) (_predefined._Cons i_1_0 is_1_1 -> let _x_2_0 = iTasks._Framework.WebService.dequeueOutput_51 is_1_1 states_1, states_2_1 = select _x_2_0::_Tuple2 1, output_2_2 = select _x_2_0::_Tuple2 0 in <{iTasks._Framework.WebService._c;335;11_541}> (<{iTasks._Framework.WebService.get`_478}> i_1_0 states_2_1) i_1_0 output_2_2 states_2_1) 
<{iTasks._Framework.WebService._c;335;11_541}> !_x_0 i_1::I output_2 !states_3 = case _x_0 (Data.Maybe.Just out_1_0 -> <{_Tuple2!3}> (<{StdList.++}> (<{iTasks._Framework.WebService.c;336;35_41}> i_1 (iTasks._Framework.WebService.toList_42 out_1_0)) output_2) (Data.Map.put (<{StdOverloaded.<;}> <{StdInt.<_17}>) i_1 Data.Queue.newQueue states_3)) (Data.Maybe.Nothing -> <{_Tuple2!3}> output_2 states_3) 
<{iTasks._Framework.WebService.c;319;99_40}> !g_l_0 = <{iTasks._Framework.WebService.g_c1;319;122_543}> g_l_0
<{iTasks._Framework.WebService.g_c1;319;122_543}> !g_l_0 = case g_l_0 (_predefined._Cons g_h_1_0 g_t_1_1 -> <{iTasks._Framework.WebService.g_c2;319;122_542}> g_h_1_0 g_t_1_1) (_ -> _predefined._Nil)
<{iTasks._Framework.WebService.g_c2;319;122_542}> !g_h_0 g_t_1 = case g_h_0 (_Tuple2 instanceNo_1_0 change_1_1 -> _predefined._Cons (iTasks._Framework.WebService.wsockTextMsg (Text.JSON.toString_7 (Text.JSON.JSONObject (_predefined._Cons (_Tuple2 "instance" (Text.JSON.JSONInt instanceNo_1_0)) (_predefined._Cons (_Tuple2 "change" (iTasks.UI.Definition.encodeUIChange change_1_1)) _predefined._Nil))))) (<{iTasks._Framework.WebService.c;319;99_40}> g_t_1)) (_ -> <{iTasks._Framework.WebService.c;319;99_40}> g_t_1)
iTasks._Framework.WebService.dataFun_47 taskUrls_0 req_1 !output_2 !_x_3 !_x_4 iworld_5 = case _x_3 (Data.Maybe.Just data_1_0 -> case _x_4 (_Tuple2 state_2_0 instances_2_1 -> let _x_3_0 = iTasks._Framework.WebService.wsockAddData state_2_0 data_1_0, state_3_1 = select _x_3_0::_Tuple2 0 in <{iTasks._Framework.WebService._c;272;11_546}> (select _x_3_0::_Tuple2 1) state_3_1 instances_2_1 iworld_5 req_1 taskUrls_0) ) (Data.Maybe.Nothing -> case _x_4 (_Tuple2 state_2_0 instances_2_1 -> let _x_3_0 = iTasks._Framework.WebService.dequeueOutput_51 instances_2_1 output_2, changes_3_1 = select _x_3_0::_Tuple2 0, output_3_2 = select _x_3_0::_Tuple2 1 in <{iTasks._Framework.WebService._c;314;11_547}> changes_3_1 state_2_0 instances_2_1 iworld_5 output_3_2) ) 
<{iTasks._Framework.WebService._c;314;11_547}> !changes_0 state_1 instances_2 iworld_3 output_4 = case changes_0 (_predefined._Nil -> _Tuple5 _predefined._Nil False (_Tuple2 state_1 instances_2) Data.Maybe.Nothing iworld_3) (_ -> _Tuple5 (StdList.flatten (<{iTasks._Framework.WebService.c;319;99_40}> changes_0)) False (_Tuple2 state_1 instances_2) (Data.Maybe.Just output_4) (select (iTasks._Framework.TaskEval.updateInstanceLastIO instances_2 iworld_3)::_Tuple2 1))
<{iTasks._Framework.WebService._c;272;11_546}> !_x_0 state_1 instances_2 iworld_3 req_4 taskUrls_5 = case _x_0 (_predefined._Cons _x_1_0 _x_1_1 -> case _x_1_0 (iTasks._Framework.WebService.WSClose msg_2_0 -> _Tuple5 (_predefined._Cons (iTasks._Framework.WebService.wsockCloseMsg msg_2_0) _predefined._Nil) True (_Tuple2 state_1 instances_2) Data.Maybe.Nothing iworld_3) (iTasks._Framework.WebService.WSTextMessage msg_2_0 -> <{iTasks._Framework.WebService._c;278;19_545}> (Text.JSON.fromString_8 msg_2_0) req_4 taskUrls_5 iworld_3 state_1 instances_2) (iTasks._Framework.WebService.WSPing msg_2_0 -> _Tuple5 (_predefined._Cons (iTasks._Framework.WebService.wsockPongMsg msg_2_0) _predefined._Nil) False (_Tuple2 state_1 instances_2) Data.Maybe.Nothing iworld_3) ) (_ -> _Tuple5 _predefined._Nil False (_Tuple2 state_1 instances_2) Data.Maybe.Nothing iworld_3)
<{iTasks._Framework.WebService._c;278;19_545}> !_x_0 req_1 taskUrls_2 iworld_3 state_4 instances_5 = case _x_0 (Text.JSON.JSONArray _x_1_0 -> case _x_1_0 (_predefined._Cons _x_2_0 _x_2_1 -> case _x_2_0 (Text.JSON.JSONInt req_3_0 -> case _x_2_1 (_predefined._Cons _x_4_0 _x_4_1 -> case _x_4_0 (Text.JSON.JSONString _x_5_0 -> case _x_5_0 ("new" -> case _x_4_1 (_predefined._Nil -> <{iTasks._Framework.WebService._c;281;27_544}> (<{iTasks._Framework.WebService.createTaskInstance`_49}> req_1 taskUrls_2 iworld_3) req_3_0 state_4 instances_5) ) ) ) ) (Text.JSON.JSONString _x_3_0 -> case _x_3_0 ("attach" -> case _x_2_1 (_predefined._Cons _x_5_0 _x_5_1 -> case _x_5_0 (Text.JSON.JSONInt instanceNo_6_0 -> case _x_5_1 (_predefined._Cons _x_7_0 _x_7_1 -> case _x_7_0 (Text.JSON.JSONString instanceKey_8_0 -> case _x_7_1 (_predefined._Nil -> _Tuple5 _predefined._Nil False (_Tuple2 state_4 (_predefined._Cons instanceNo_6_0 instances_5)) Data.Maybe.Nothing (iTasks._Framework.TaskStore.queueEvent instanceNo_6_0 iTasks._Framework.Task.ResetEvent iworld_3)) ) ) ) ) ) ("detach" -> case _x_2_1 (_predefined._Cons _x_5_0 _x_5_1 -> case _x_5_0 (Text.JSON.JSONInt instanceNo_6_0 -> case _x_5_1 (_predefined._Cons _x_7_0 _x_7_1 -> case _x_7_0 (Text.JSON.JSONString instanceKey_8_0 -> case _x_7_1 (_predefined._Nil -> _Tuple5 _predefined._Nil False (_Tuple2 state_4 (StdList.removeMember_57 instanceNo_6_0 instances_5)) Data.Maybe.Nothing iworld_3) ) ) ) ) ) ("event" -> case _x_2_1 (_predefined._Cons _x_5_0 _x_5_1 -> case _x_5_0 (Text.JSON.JSONInt instanceNo_6_0 -> case _x_5_1 (_predefined._Cons _x_7_0 _x_7_1 -> case _x_7_0 (Text.JSON.JSONArray _x_8_0 -> case _x_8_0 (_predefined._Cons _x_9_0 _x_9_1 -> case _x_9_0 (Text.JSON.JSONString task_10_0 -> case _x_9_1 (_predefined._Cons _x_11_0 _x_11_1 -> case _x_11_0 (Text.JSON.JSONNull -> case _x_11_1 (_predefined._Cons _x_13_0 _x_13_1 -> case _x_13_0 (Text.JSON.JSONString action_14_0 -> case _x_13_1 (_predefined._Nil -> case _x_7_1 (_predefined._Nil -> _Tuple5 _predefined._Nil False (_Tuple2 state_4 instances_5) Data.Maybe.Nothing (iTasks._Framework.TaskStore.queueEvent instanceNo_6_0 (iTasks._Framework.Task.ActionEvent (iTasks.API.Core.Types.fromString_46 task_10_0) action_14_0) iworld_3)) ) ) ) ) (Text.JSON.JSONString name_12_0 -> case _x_11_1 (_predefined._Cons value_13_0 _x_13_1 -> case _x_13_1 (_predefined._Nil -> case _x_7_1 (_predefined._Nil -> _Tuple5 _predefined._Nil False (_Tuple2 state_4 instances_5) Data.Maybe.Nothing (iTasks._Framework.TaskStore.queueEvent instanceNo_6_0 (iTasks._Framework.Task.EditEvent (iTasks.API.Core.Types.fromString_46 task_10_0) name_12_0 value_13_0) iworld_3)) ) ) ) ) ) ) ) ) ) ) ) ) ) ) (_ -> _Tuple5 (iTasks._Framework.WebService.wsockTextMsg (Text.JSON.toString_7 (Text.JSON.JSONArray (_predefined._Cons (Text.JSON.JSONString "ERROR") (_predefined._Cons (Text.JSON.JSONString "Unknown event") _predefined._Nil))))) False (_Tuple2 state_4 instances_5) Data.Maybe.Nothing iworld_3)
<{iTasks._Framework.WebService._c;281;27_544}> !_x_0 req_1::I state_2 instances_3 = case _x_0 (_Tuple2 _x_1_0 iworld_1_1 -> case _x_1_0 (Data.Error.Error _x_2_0 -> case _x_2_0 (_Tuple2 _x_3_0 err_3_1 -> _Tuple5 (iTasks._Framework.WebService.wsockTextMsg (Text.JSON.toString_7 (Text.JSON.JSONArray (_predefined._Cons (Text.JSON.JSONInt req_1) (_predefined._Cons (Text.JSON.JSONString "ERROR") (_predefined._Cons (Text.JSON.JSONString err_3_1) _predefined._Nil)))))) False (_Tuple2 state_2 instances_3) Data.Maybe.Nothing iworld_1_1) ) (Data.Error.Ok _x_2_0 -> case _x_2_0 (_Tuple2 instanceNo_3_0 instanceKey_3_1 -> _Tuple5 (iTasks._Framework.WebService.wsockTextMsg (Text.JSON.toString_7 (Text.JSON.JSONArray (_predefined._Cons (Text.JSON.JSONInt req_1) (_predefined._Cons (Text.JSON.JSONObject (_predefined._Cons (_Tuple2 "instanceNo" (Text.JSON.JSONInt instanceNo_3_0)) (_predefined._Cons (_Tuple2 "instanceKey" (Text.JSON.JSONString instanceKey_3_1)) _predefined._Nil))) _predefined._Nil))))) False (_Tuple2 state_2 instances_3) Data.Maybe.Nothing (iTasks._Framework.TaskStore.queueEvent instanceNo_3_0 iTasks._Framework.Task.ResetEvent iworld_1_1)) ) ) 
iTasks._Framework.WebService.disconnectFun_48 _x_0 _x_1 !_x_2 iworld_3 = case _x_2 (_Tuple2 state_1_0 instances_1_1 -> _Tuple2 Data.Maybe.Nothing (select (iTasks._Framework.TaskEval.updateInstanceDisconnect instances_1_1 iworld_3)::_Tuple2 1)) (_ -> _Tuple2 Data.Maybe.Nothing iworld_3)
iTasks._Framework.WebService.taskUIService !taskUrls_0 = <{_Tuple5!31}> (iTasks._Framework.WebService.matchFun_44 (<{iTasks._Framework.WebService.c;247;41_38}> taskUrls_0)) True (<{iTasks._Framework.WebService.reqFun`_45}> taskUrls_0) (iTasks._Framework.WebService.dataFun_47 taskUrls_0) iTasks._Framework.WebService.disconnectFun_48
iTasks._Framework.WebService.matchFun_54::B !path_0 = <{iTasks._Framework.WebService._c;361;21_548}> (StdList.dropWhile (<{StdString.==_2}> "") (Text.split_12 "/" path_0))
<{iTasks._Framework.WebService._c;361;21_548}>::B !_x_0 = case _x_0 (_predefined._Cons _x_1_0 _x_1_1 -> case _x_1_0 ("upload" -> case _x_1_1 (_predefined._Nil -> True) ) ("download" -> case _x_1_1 (_predefined._Cons _x_3_0 _x_3_1 -> case _x_3_1 (_predefined._Nil -> True) ) ) ) (_ -> False)
iTasks._Framework.WebService.anon_80 k_0 x_1 xs_2 = _predefined._Cons (_Tuple2 k_0 x_1) xs_2
iTasks._Framework.WebService.jsonResponse !_vtoString_0 json_1 = update Internet.HTTP.okResponse::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Content-Type" "text/json") (_predefined._Cons (_Tuple2 "Access-Control-Allow-Origin" "*") _predefined._Nil),3:select _vtoString_0::<{StdOverloaded.toString;}> 0 json_1]
iTasks._Framework.WebService.createDocumentsFromUploads !_x_0 iworld_1 = case _x_0 (_predefined._Nil -> _Tuple2 _predefined._Nil iworld_1) (_predefined._Cons _x_1_0 us_1_1 -> case _x_1_0 (_Tuple2 n_2_0 u_2_1 -> let _x_3_0 = iTasks._Framework.TaskStore.createDocument (select u_2_1::Internet.HTTP._HTTPUpload 1) (select u_2_1::Internet.HTTP._HTTPUpload 2) (select u_2_1::Internet.HTTP._HTTPUpload 3) iworld_1, mbD_3_1 = select _x_3_0::_Tuple2 0 in case (Data.Error.isError mbD_3_1) (True -> iTasks._Framework.WebService.createDocumentsFromUploads us_1_1 (select _x_3_0::_Tuple2 1)) (False -> let _x_5_0 = iTasks._Framework.WebService.createDocumentsFromUploads us_1_1 (select _x_3_0::_Tuple2 1) in _Tuple2 (_predefined._Cons (Data.Error.fromOk mbD_3_1) (select _x_5_0::_Tuple2 0)) (select _x_5_0::_Tuple2 1)) ) ) 
iTasks._Framework.WebService.JSONEncode_s_172 !_vJSONEncode_s_0 !x1_1::B !x2_2 = Text.JSON.JSONEncode__List_17 (select _vJSONEncode_s_0::<{iTasks._Framework.WebService.JSONEncode_s;}> 0) x1_1 x2_2
iTasks._Framework.WebService.jsonResponse_479 json_0 = update Internet.HTTP.okResponse::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Content-Type" "text/json") (_predefined._Cons (_Tuple2 "Access-Control-Allow-Origin" "*") _predefined._Nil),3:Text.JSON.toString_7 json_0]
iTasks._Framework.WebService.JSONEncode_s_480 !x1_0::B !x2_1 = Text.JSON.JSONEncode__List_17 iTasks.API.Core.Types.JSONEncode_Document_52 x1_0 x2_1
iTasks._Framework.WebService.reqFun_55 !req_0 output_1 !iworld_2 = case iworld_2 (iTasks._Framework.IWorld._IWorld server_1_0 config_1_1 clocks_1_2 current_1_3 random_1_4 sdsNotifyRequests_1_5 memoryShares_1_6 cachedShares_1_7 exposedShares_1_8 jsCompilerState_1_9 ioTasks_1_10 ioStates_1_11 world_1_12 resources_1_13 onClient_1_14 shutdown_1_15 -> case server_1_0 (iTasks._Framework.IWorld._ServerInfo serverName_2_0 serverURL_2_1 build_2_2 paths_2_3 -> <{iTasks._Framework.WebService._c;367;11_550}> (StdList.dropWhile (<{StdString.==_2}> "") (Text.split_12 "/" (select req_0::Internet.HTTP._HTTPRequest 1))) req_0 iworld_2) ) 
<{iTasks._Framework.WebService._c;367;11_550}> !_x_0 req_1 iworld_2 = case _x_0 (_predefined._Cons _x_1_0 _x_1_1 -> case _x_1_0 ("upload" -> case _x_1_1 (_predefined._Nil -> let uploads_4_0 = Data.Map.foldrWithKey iTasks._Framework.WebService.anon_80 _predefined._Nil (select req_1::Internet.HTTP._HTTPRequest 10) in case (<{StdInt.==_16}> (StdList.length_47 uploads_4_0) 0) (True -> _Tuple4 (iTasks._Framework.WebService.jsonResponse_479 (Text.JSON.JSONArray _predefined._Nil)) Data.Maybe.Nothing Data.Maybe.Nothing iworld_2) (False -> let _x_6_0 = iTasks._Framework.WebService.createDocumentsFromUploads uploads_4_0 iworld_2 in _Tuple4 (iTasks._Framework.WebService.jsonResponse_479 (Text.JSON.toJSON (<{iTasks._Framework.WebService.JSONEncode_s;}> iTasks._Framework.WebService.JSONEncode_s_480) (select _x_6_0::_Tuple2 0))) Data.Maybe.Nothing Data.Maybe.Nothing (select _x_6_0::_Tuple2 1)) ) ) ("download" -> case _x_1_1 (_predefined._Cons downloadParam_3_0 _x_3_1 -> case _x_3_1 (_predefined._Nil -> let _x_5_0 = iTasks._Framework.TaskStore.loadDocumentContent downloadParam_3_0 iworld_2, iworld_5_1 = select _x_5_0::_Tuple2 1, _x_5_2 = iTasks._Framework.TaskStore.loadDocumentMeta downloadParam_3_0 iworld_5_1, iworld_5_3 = select _x_5_2::_Tuple2 1 in <{iTasks._Framework.WebService._c;377;19_549}> (_Tuple2 (select _x_5_0::_Tuple2 0) (select _x_5_2::_Tuple2 0)) iworld_5_3 req_1) ) ) ) (_ -> _Tuple4 (iTasks._Framework.HtmlUtil.notFoundResponse req_1) Data.Maybe.Nothing Data.Maybe.Nothing iworld_2)
<{iTasks._Framework.WebService._c;377;19_549}> !_x_0 iworld_1 req_2 = case _x_0 (_Tuple2 _x_1_0 _x_1_1 -> case _x_1_0 (Data.Maybe.Just content_2_0 -> case _x_1_1 (Data.Maybe.Just _x_3_0 -> case _x_3_0 (iTasks.API.Core.Types._Document document_4_0 contentUrl_4_1 name_4_2 mime_4_3 size_4_4 -> _Tuple4 (update Internet.HTTP.okResponse::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Content-Type" mime_4_3) (_predefined._Cons (_Tuple2 "Content-Length" (StdString.toString_5 size_4_4)) (_predefined._Cons (_Tuple2 "Content-Disposition" (<{StdString.+++_11}> "attachment;filename=\"" (<{StdString.+++_11}> name_4_2 "\""))) _predefined._Nil)),3:content_2_0]) Data.Maybe.Nothing Data.Maybe.Nothing iworld_1) ) ) ) (_ -> _Tuple4 (iTasks._Framework.HtmlUtil.notFoundResponse req_2) Data.Maybe.Nothing Data.Maybe.Nothing iworld_1)
iTasks._Framework.WebService.dataFun_56 _x_0 _x_1 _x_2 s_3 env_4 = _Tuple5 _predefined._Nil True s_3 Data.Maybe.Nothing env_4
iTasks._Framework.WebService.lostFun_57 _x_0 _x_1 s_2 env_3 = _Tuple2 Data.Maybe.Nothing env_3
iTasks._Framework.WebService.documentService = <{_Tuple5!31}> iTasks._Framework.WebService.matchFun_54 True iTasks._Framework.WebService.reqFun_55 iTasks._Framework.WebService.dataFun_56 iTasks._Framework.WebService.lostFun_57
iTasks._Framework.WebService.anon_81 !f_0 g_1 x_2 = f_0 (g_1 x_2)
iTasks._Framework.WebService.anon_481 !_x_0 !_x_1 !g_2 x_3 = Text.replaceSubString_9 _x_0 _x_1 (g_2 x_3)
iTasks._Framework.WebService.anon_482 !_x_0 !_x_1 !_x_2 !_x_3 !x_4 = Text.replaceSubString_9 _x_0 _x_1 (Text.replaceSubString_9 _x_2 _x_3 x_4)
iTasks._Framework.WebService.filePath_59 !path_0 = iTasks._Framework.WebService.anon_482 "/" (_SystemArray.update_21 (_SystemArray._createArray_16 1) 0 System.FilePath.pathSeparator) ".." "" path_0
iTasks._Framework.WebService.mimeType_60 !path_0 = Text.Encodings.MIME.extensionToMimeType (System.FilePath.takeExtension path_0)
iTasks._Framework.WebService.serveStaticResource_58 taskPaths_0 req_1 !_x_2 iworld_3 = case _x_2 (_predefined._Nil -> _Tuple2 (iTasks._Framework.HtmlUtil.notFoundResponse req_1) iworld_3) (_predefined._Cons d_1_0 ds_1_1 -> case iworld_3 (iTasks._Framework.IWorld._IWorld server_2_0 config_2_1 clocks_2_2 current_2_3 random_2_4 sdsNotifyRequests_2_5 memoryShares_2_6 cachedShares_2_7 exposedShares_2_8 jsCompilerState_2_9 ioTasks_2_10 ioStates_2_11 world_2_12 resources_2_13 onClient_2_14 shutdown_2_15 -> let filename_3_0 = <{iTasks._Framework.WebService._if;422;34_551}> (StdList.isMember (<{StdClass.Eq;}> (<{StdOverloaded.==;}> <{StdString.==_2}>)) (select req_1::Internet.HTTP._HTTPRequest 1) taskPaths_0) d_1_0 req_1, _x_3_1 = System.File.getFileInfo filename_3_0 world_2_12 in case (<{iTasks._Framework.WebService._c;427;15_552}> (select _x_3_1::_Tuple2 0)) (True -> iTasks._Framework.WebService.serveStaticResource_58 taskPaths_0 req_1 ds_1_1 (update iworld_3::iTasks._Framework.IWorld._IWorld [12:select _x_3_1::_Tuple2 1])) (False -> let world_5_0 = select _x_3_1::_Tuple2 1, _x_5_1 = System.File.readFile (<{StdFile.FileSystem;}> StdFile.fclose_30 StdFile.fopen_31 StdFile.sfopen_32 StdFile.stdio_33) filename_3_0 world_5_0, world_5_2 = select _x_5_1::_Tuple2 1 in <{iTasks._Framework.WebService._c;430;15_553}> (select _x_5_1::_Tuple2 0) filename_3_0 iworld_3 world_5_2) ) ) 
<{iTasks._Framework.WebService._c;430;15_553}> !_x_0 filename_1 iworld_2 world_3 = case _x_0 (Data.Error.Ok content_1_0 -> _Tuple2 (update Internet.HTTP.okResponse::Internet.HTTP._HTTPResponse [2:_predefined._Cons (_Tuple2 "Content-Type" (iTasks._Framework.WebService.mimeType_60 filename_1)) (_predefined._Cons (_Tuple2 "Content-Length" (StdString.toString_5 (_SystemArray.size_20 content_1_0))) _predefined._Nil),3:content_1_0]) (update iworld_2::iTasks._Framework.IWorld._IWorld [12:world_3])) (Data.Error.Error e_1_0 -> _Tuple2 (Internet.HTTP.errorResponse (<{StdString.+++_11}> (System.File.toString_10 e_1_0) (<{StdString.+++_11}> " (" (<{StdString.+++_11}> filename_1 ")")))) (update iworld_2::iTasks._Framework.IWorld._IWorld [12:world_3])) 
<{iTasks._Framework.WebService._c;427;15_552}>::B !_x_0 = case _x_0 (Data.Error.Ok info_1_0 -> select info_1_0::System.File._FileInfo 0) (_ -> True)
<{iTasks._Framework.WebService._if;422;34_551}> !_x_0::B !d_1 req_2 = case _x_0 (True -> <{StdString.+++_11}> d_1 (iTasks._Framework.WebService.filePath_59 "/index.html")) (_ -> <{StdString.+++_11}> d_1 (iTasks._Framework.WebService.filePath_59 (select req_2::Internet.HTTP._HTTPRequest 1)))
iTasks._Framework.WebService.handleStaticResourceRequest_64 taskPaths_0 !req_1 !iworld_2 = case iworld_2 (iTasks._Framework.IWorld._IWorld server_1_0 config_1_1 clocks_1_2 current_1_3 random_1_4 sdsNotifyRequests_1_5 memoryShares_1_6 cachedShares_1_7 exposedShares_1_8 jsCompilerState_1_9 ioTasks_1_10 ioStates_1_11 world_1_12 resources_1_13 onClient_1_14 shutdown_1_15 -> case server_1_0 (iTasks._Framework.IWorld._ServerInfo serverName_2_0 serverURL_2_1 build_2_2 _x_2_3 -> case _x_2_3 (iTasks._Framework.IWorld._SystemPaths appDirectory_3_0 dataDirectory_3_1 publicWebDirectories_3_2 saplDirectory_3_3 -> iTasks._Framework.WebService.serveStaticResource_58 taskPaths_0 req_1 publicWebDirectories_3_2 iworld_2) ) ) 
iTasks._Framework.WebService.initFun_61 taskPaths_0 req_1 _x_2 env_3 = let _x_1_0 = iTasks._Framework.WebService.handleStaticResourceRequest_64 taskPaths_0 req_1 env_3 in _Tuple4 (select _x_1_0::_Tuple2 0) Data.Maybe.Nothing Data.Maybe.Nothing (select _x_1_0::_Tuple2 1)
iTasks._Framework.WebService.dataFun_62 _x_0 _x_1 _x_2 s_3 env_4 = _Tuple5 _predefined._Nil True s_3 Data.Maybe.Nothing env_4
iTasks._Framework.WebService.lostFun_63 _x_0 _x_1 s_2 env_3 = _Tuple2 Data.Maybe.Nothing env_3
iTasks._Framework.WebService.staticResourceService taskPaths_0 = <{_Tuple5!31}> (StdFunc.const True) True (iTasks._Framework.WebService.initFun_61 taskPaths_0) iTasks._Framework.WebService.dataFun_62 iTasks._Framework.WebService.lostFun_63
<{iTasks._Framework.WebService.TD;ConnectionState}> _x_0::B = _predefined._Nil
<{iTasks._Framework.WebService.TD;WebSockState}> _x_0::B = _predefined._Nil
<{iTasks._Framework.WebService.TD;WebSockEvent}> _x_0::B = _predefined._Nil
<{iTasks._Framework.WebService.TD;ChangeQueues}> _x_0::B = _predefined._Nil
<{iTasks._Framework.WebService.TD;NetTaskState}> _x_0::B = _predefined._Nil
<{iTasks._Framework.WebService.TD;HttpReqState}> _x_0::B = _predefined._Nil

:: iTasks._Framework.WebService.WebSockEvent = iTasks._Framework.WebService.WSTextMessage a1 | iTasks._Framework.WebService.WSBinMessage a1 | iTasks._Framework.WebService.WSClose a1 | iTasks._Framework.WebService.WSPing a1
:: iTasks._Framework.WebService.NetTaskState = iTasks._Framework.WebService.NTIdle a1 a2 | iTasks._Framework.WebService.NTReadingRequest a1 | iTasks._Framework.WebService.NTProcessingRequest a1 a2

|| Converted Records
:: iTasks._Framework.WebService._WebSockState = {!iTasks._Framework.WebService.cur_frame, !iTasks._Framework.WebService.message_text::B, !iTasks._Framework.WebService.message_data}

:: iTasks._Framework.WebService._HttpReqState = {iTasks._Framework.WebService.request, iTasks._Framework.WebService.method_done::B, iTasks._Framework.WebService.headers_done::B, iTasks._Framework.WebService.data_done::B, iTasks._Framework.WebService.error::B}

:: <{iTasks._Framework.WebService.JSONEncode_s;}> = {!iTasks._Framework.WebService.JSONEncode_s}

:: <{iTasks._Framework.WebService.JSONEncode_ss;}> = {!iTasks._Framework.WebService.JSONEncode_ss}

:: <{iTasks._Framework.WebService.JSONEncode_sss;}> = {!iTasks._Framework.WebService.JSONEncode_sss}

:: <{iTasks._Framework.WebService.JSONDecode_s;}> = {!iTasks._Framework.WebService.JSONDecode_s}

:: <{iTasks._Framework.WebService.JSONDecode_ss;}> = {!iTasks._Framework.WebService.JSONDecode_ss}

:: <{iTasks._Framework.WebService.JSONDecode_sss;}> = {!iTasks._Framework.WebService.JSONDecode_sss}

:: <{iTasks._Framework.WebService.gDefault_s;}> = {iTasks._Framework.WebService.gDefault_s}

:: <{iTasks._Framework.WebService.gDefault_ss;}> = {iTasks._Framework.WebService.gDefault_ss}

:: <{iTasks._Framework.WebService.gDefault_sss;}> = {iTasks._Framework.WebService.gDefault_sss}

:: <{iTasks._Framework.WebService.gText_s;}> = {!iTasks._Framework.WebService.gText_s}

:: <{iTasks._Framework.WebService.gText_ss;}> = {!iTasks._Framework.WebService.gText_ss}

:: <{iTasks._Framework.WebService.gText_sss;}> = {!iTasks._Framework.WebService.gText_sss}

:: <{iTasks._Framework.WebService.gEditor_s;}> = {iTasks._Framework.WebService.gEditor_s}

:: <{iTasks._Framework.WebService.gEditor_ss;}> = {iTasks._Framework.WebService.gEditor_ss}

:: <{iTasks._Framework.WebService.gEditor_sss;}> = {iTasks._Framework.WebService.gEditor_sss}

:: <{iTasks._Framework.WebService.gEq_s;}> = {!iTasks._Framework.WebService.gEq_s}

:: <{iTasks._Framework.WebService.gEq_ss;}> = {!iTasks._Framework.WebService.gEq_ss}

:: <{iTasks._Framework.WebService.gEq_sss;}> = {!iTasks._Framework.WebService.gEq_sss}

:: <{iTasks._Framework.WebService.JSONEncode_ssss;}> = {!iTasks._Framework.WebService.JSONEncode_ssss}

:: <{iTasks._Framework.WebService.JSONDecode_ssss;}> = {!iTasks._Framework.WebService.JSONDecode_ssss}

:: <{iTasks._Framework.WebService.gEq_ssss;}> = {!iTasks._Framework.WebService.gEq_ssss}

:: <{iTasks._Framework.WebService.gDefault_ssss;}> = {iTasks._Framework.WebService.gDefault_ssss}

:: <{iTasks._Framework.WebService.gEq_sssss;}> = {!iTasks._Framework.WebService.gEq_sssss}

:: <{iTasks._Framework.WebService.gEq_ssssss;}> = {!iTasks._Framework.WebService.gEq_ssssss}

:: <{iTasks._Framework.WebService.gEq_sssssss;}> = {!iTasks._Framework.WebService.gEq_sssssss}

:: <{iTasks._Framework.WebService.gEq_ssssssss;}> = {!iTasks._Framework.WebService.gEq_ssssssss}

:: <{iTasks._Framework.WebService.gEq_sssssssss;}> = {!iTasks._Framework.WebService.gEq_sssssssss}

:: <{iTasks._Framework.WebService.bimap_s;}> = {iTasks._Framework.WebService.bimap_s}

:: <{iTasks._Framework.WebService.bimap_ss;}> = {iTasks._Framework.WebService.bimap_ss}

:: <{iTasks._Framework.WebService.bimap_sss;}> = {iTasks._Framework.WebService.bimap_sss}

:: <{iTasks._Framework.WebService.JSONEncode_sssss;}> = {!iTasks._Framework.WebService.JSONEncode_sssss}

:: <{iTasks._Framework.WebService.JSONEncode_ssssss;}> = {!iTasks._Framework.WebService.JSONEncode_ssssss}

:: <{iTasks._Framework.WebService.JSONEncode_sssssss;}> = {!iTasks._Framework.WebService.JSONEncode_sssssss}

:: <{iTasks._Framework.WebService.JSONEncode_ssssssss;}> = {!iTasks._Framework.WebService.JSONEncode_ssssssss}

:: <{iTasks._Framework.WebService.JSONEncode_sssssssss;}> = {!iTasks._Framework.WebService.JSONEncode_sssssssss}

:: <{iTasks._Framework.WebService.JSONDecode_sssss;}> = {!iTasks._Framework.WebService.JSONDecode_sssss}

:: <{iTasks._Framework.WebService.JSONDecode_ssssss;}> = {!iTasks._Framework.WebService.JSONDecode_ssssss}

:: <{iTasks._Framework.WebService.JSONDecode_sssssss;}> = {!iTasks._Framework.WebService.JSONDecode_sssssss}

:: <{iTasks._Framework.WebService.JSONDecode_ssssssss;}> = {!iTasks._Framework.WebService.JSONDecode_ssssssss}

:: <{iTasks._Framework.WebService.JSONDecode_sssssssss;}> = {!iTasks._Framework.WebService.JSONDecode_sssssssss}

:: <{iTasks._Framework.WebService.gLexOrd_s;}> = {!iTasks._Framework.WebService.gLexOrd_s}

:: <{iTasks._Framework.WebService.gLexOrd_ss;}> = {!iTasks._Framework.WebService.gLexOrd_ss}

:: <{iTasks._Framework.WebService.gLexOrd_sss;}> = {!iTasks._Framework.WebService.gLexOrd_sss}

:: <{iTasks._Framework.WebService.gLexOrd_ssss;}> = {!iTasks._Framework.WebService.gLexOrd_ssss}

:: <{iTasks._Framework.WebService.gLexOrd_sssss;}> = {!iTasks._Framework.WebService.gLexOrd_sssss}

:: <{iTasks._Framework.WebService.gLexOrd_ssssss;}> = {!iTasks._Framework.WebService.gLexOrd_ssssss}

:: <{iTasks._Framework.WebService.gLexOrd_sssssss;}> = {!iTasks._Framework.WebService.gLexOrd_sssssss}

:: <{iTasks._Framework.WebService.gLexOrd_ssssssss;}> = {!iTasks._Framework.WebService.gLexOrd_ssssssss}

:: <{iTasks._Framework.WebService.gLexOrd_sssssssss;}> = {!iTasks._Framework.WebService.gLexOrd_sssssssss}

:: <{iTasks._Framework.WebService.gText_ssss;}> = {!iTasks._Framework.WebService.gText_ssss}

:: <{iTasks._Framework.WebService.gText_sssss;}> = {!iTasks._Framework.WebService.gText_sssss}

:: <{iTasks._Framework.WebService.gText_ssssss;}> = {!iTasks._Framework.WebService.gText_ssssss}

:: <{iTasks._Framework.WebService.gText_sssssss;}> = {!iTasks._Framework.WebService.gText_sssssss}

:: <{iTasks._Framework.WebService.gText_ssssssss;}> = {!iTasks._Framework.WebService.gText_ssssssss}

:: <{iTasks._Framework.WebService.gText_sssssssss;}> = {!iTasks._Framework.WebService.gText_sssssssss}

:: <{iTasks._Framework.WebService.gDefault_sssss;}> = {iTasks._Framework.WebService.gDefault_sssss}

:: <{iTasks._Framework.WebService.gDefault_ssssss;}> = {iTasks._Framework.WebService.gDefault_ssssss}

:: <{iTasks._Framework.WebService.gDefault_sssssss;}> = {iTasks._Framework.WebService.gDefault_sssssss}

:: <{iTasks._Framework.WebService.gDefault_ssssssss;}> = {iTasks._Framework.WebService.gDefault_ssssssss}

:: <{iTasks._Framework.WebService.gDefault_sssssssss;}> = {iTasks._Framework.WebService.gDefault_sssssssss}

:: <{iTasks._Framework.WebService.gEditor_ssss;}> = {iTasks._Framework.WebService.gEditor_ssss}

:: <{iTasks._Framework.WebService.gEditor_sssss;}> = {iTasks._Framework.WebService.gEditor_sssss}

:: <{iTasks._Framework.WebService.gEditor_ssssss;}> = {iTasks._Framework.WebService.gEditor_ssssss}

:: <{iTasks._Framework.WebService.gEditor_sssssss;}> = {iTasks._Framework.WebService.gEditor_sssssss}

